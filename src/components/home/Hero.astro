---
import { t } from '@/i18n';
import type { Lang } from '@/i18n/config';

interface Props {
  lang: Lang;
  chips: Array<{ [key: string]: string }>;
  location: string;
  email: string;
  linkedin: string;
}

const { lang, chips, location, email, linkedin } = Astro.props;

// Helper to get localized string
const getStr = (obj: any) => (typeof obj === 'string' ? obj : obj[lang]);
---

<section class="hero-section section min-h-[62vh] flex items-start pt-10 md:pt-14 relative overflow-hidden">
  <!-- Subtle hero framing -->
  <div class="absolute inset-0 bg-gradient-to-b from-transparent to-background-alt/20 pointer-events-none"></div>
  <div class="absolute left-0 top-20 bottom-20 w-px bg-border/60 pointer-events-none"></div>
  <div class="absolute left-0 top-0 h-full w-[45%] bg-gradient-to-br from-background-alt/70 to-transparent pointer-events-none"></div>
  <svg class="hero-leaf" viewBox="0 0 800 1000" aria-hidden="true">
    <defs>
      <linearGradient id="hero-leaf-fill" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" stop-color="var(--color-accent-light)" stop-opacity="0.22" />
        <stop offset="100%" stop-color="var(--color-accent)" stop-opacity="0.3" />
      </linearGradient>
      <linearGradient id="hero-leaf-vein" x1="0%" y1="0%" x2="0%" y2="100%">
        <stop offset="0%" stop-color="var(--color-accent)" stop-opacity="0.32" />
        <stop offset="100%" stop-color="var(--color-primary)" stop-opacity="0.16" />
      </linearGradient>
    </defs>
    <g transform="translate(120 40) rotate(-8)">
      <path
        d="M 350 40
           C 520 110, 600 300, 540 520
           C 495 690, 380 860, 220 940
           C 120 990, 40 900, 60 740
           C 85 540, 150 330, 240 190
           C 285 120, 320 75, 350 40 Z"
        fill="url(#hero-leaf-fill)"
      />
      <path
        d="M 350 50 C 310 170, 270 310, 230 470 C 200 600, 170 720, 150 840"
        fill="none"
        stroke="url(#hero-leaf-vein)"
        stroke-width="6"
        stroke-linecap="round"
      />
      <path
        d="M 290 220 C 360 200, 430 210, 500 250"
        fill="none"
        stroke="url(#hero-leaf-vein)"
        stroke-width="3.5"
        stroke-linecap="round"
      />
      <path
        d="M 250 340 C 330 320, 420 335, 510 390"
        fill="none"
        stroke="url(#hero-leaf-vein)"
        stroke-width="3"
        stroke-linecap="round"
      />
      <path
        d="M 210 470 C 310 455, 410 485, 500 560"
        fill="none"
        stroke="url(#hero-leaf-vein)"
        stroke-width="2.6"
        stroke-linecap="round"
      />
      <path
        d="M 180 620 C 300 610, 400 650, 470 740"
        fill="none"
        stroke="url(#hero-leaf-vein)"
        stroke-width="2.4"
        stroke-linecap="round"
      />
      <path
        d="M 140 760 C 250 770, 320 810, 380 880"
        fill="none"
        stroke="url(#hero-leaf-vein)"
        stroke-width="2.2"
        stroke-linecap="round"
      />
    </g>
  </svg>

  <div class="container relative z-10">
    <div class="max-w-4xl">
      <!-- Chips -->
      <div class="flex flex-wrap gap-2 mb-4 stagger-children">
        {chips.map((chip, index) => (
          <span 
            class="inline-flex items-center px-3 py-1 text-xs font-semibold tracking-wide rounded-full bg-background-alt text-foreground border border-border/70 shadow-sm animate-fade-in-up fill-mode-forwards"
            style={`animation-delay: ${index * 100}ms;`}
          >
            {getStr(chip)}
          </span>
        ))}
      </div>

      <!-- Headline -->
      <div class="overflow-hidden mb-4 pb-2">
        <h1 class="text-4xl md:text-5xl lg:text-7xl font-bold text-foreground animate-reveal-text font-display leading-tight">
          {t(lang, 'hero.headline')}
        </h1>
      </div>

      <!-- Subheadline -->
      <div class="overflow-hidden mb-5 pb-1">
        <p class="text-xl md:text-2xl text-foreground opacity-80 max-w-2xl animate-reveal-text" style="animation-delay: 200ms;">
          {t(lang, 'hero.subheadline')}
        </p>
      </div>

      <!-- Meta Line -->
      <div class="flex flex-wrap items-center gap-4 text-sm text-muted mb-6 animate-fade-in-up fill-mode-forwards" style="animation-delay: 500ms;">
        <span>{location}</span>
        <span class="text-border">|</span>
        <a href={`mailto:${email}`} class="hover:text-accent transition-colors">
          {email}
        </a>
        <span class="text-border">|</span>
        <a href={linkedin} target="_blank" rel="noopener noreferrer" class="hover:text-accent transition-colors">
          LinkedIn
        </a>
      </div>

      <!-- CTAs -->
      <div class="flex flex-wrap gap-4 animate-fade-in-up fill-mode-forwards" style="animation-delay: 600ms;">
        <a
          href="#systems"
          class="hero-primary inline-flex items-center justify-center px-7 py-3 text-base font-semibold rounded-lg border border-primary text-primary bg-transparent hover:bg-primary/10 transition-colors shadow-lg hover:shadow-xl hover:-translate-y-0.5 transform duration-200"
        >
          {t(lang, 'hero.cta.viewSystems')}
        </a>
        <a
          href={`/${lang}/resume`}
          class="hero-secondary inline-flex items-center justify-center px-6 py-3 text-base font-medium rounded-lg border border-border text-foreground bg-background-alt/60 hover:bg-background-alt transition-colors hover:border-accent"
        >
          {t(lang, 'hero.cta.recruiterMode')}
        </a>
      </div>
    </div>
  </div>
</section>

<style>
  .fill-mode-forwards {
    animation-fill-mode: forwards;
  }
  
  @keyframes revealText {
    from {
      transform: translateY(100%);
    }
    to {
      transform: translateY(0);
    }
  }
  
  .animate-reveal-text {
    transform: translateY(100%);
    animation: revealText 1s cubic-bezier(0.16, 1, 0.3, 1) forwards;
  }
  .hero-leaf {
    position: absolute;
    right: -4%;
    top: -6%;
    width: min(70vw, 720px);
    height: auto;
    opacity: 0.34;
    filter: blur(0.3px);
    pointer-events: none;
    z-index: 0;
  }

  :root.dark .hero-primary {
    background: linear-gradient(135deg, var(--color-accent), var(--color-primary));
    color: #0a0a0a;
    border: 1px solid rgba(255, 255, 255, 0.12);
  }

  :root.dark .hero-primary:hover {
    background: linear-gradient(135deg, var(--color-accent-light), var(--color-accent));
  }

  :root.dark .hero-secondary {
    background: rgba(255, 255, 255, 0.06);
    color: var(--color-foreground);
    border-color: rgba(255, 255, 255, 0.18);
  }

  :root.dark .hero-secondary:hover {
    background: rgba(45, 212, 191, 0.14);
    border-color: rgba(45, 212, 191, 0.4);
  }

  @media (prefers-reduced-motion: reduce) {
    .animate-reveal-text {
      transform: none;
      animation: none;
    }
  }
</style>

<script>
  // Magnetic button effect for CTAs
  function initMagneticButtons() {
    // Check if user prefers reduced motion
    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    if (prefersReducedMotion) return;

    const buttons = document.querySelectorAll('.hero-section a[href="#systems"], .hero-section a[href*="/resume"]');

    buttons.forEach(button => {
      const el = button as HTMLElement;

      el.addEventListener('mouseenter', () => {
        el.style.transition = 'transform 0.1s ease-out';
      });

      el.addEventListener('mousemove', (e: MouseEvent) => {
        const rect = el.getBoundingClientRect();
        const x = e.clientX - rect.left - rect.width / 2;
        const y = e.clientY - rect.top - rect.height / 2;

        el.style.transform = `translate(${x * 0.15}px, ${y * 0.15}px)`;
      });

      el.addEventListener('mouseleave', () => {
        el.style.transition = 'transform 0.3s ease-out';
        el.style.transform = 'translate(0, 0)';
      });
    });
  }

  // Initialize on page load
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initMagneticButtons);
  } else {
    initMagneticButtons();
  }
</script>
