---
import { t } from '@/i18n';
import type { Lang } from '@/i18n/config';
import LiquidSwirl from '@/components/effects/LiquidSwirl.astro';

interface Props {
  lang: Lang;
  email: string;
  location: string;
  linkedin: string;
}

const { lang, email, location, linkedin } = Astro.props;

// Contact methods with icons and colors
const contactMethods = [
  {
    id: 'email',
    icon: 'mail',
    href: `mailto:${email}`,
    label: t(lang, 'contact.email'),
    value: email,
    color: '#6ee7b7',
    description: lang === 'es' ? 'Respuesta en 24h' : lang === 'fr' ? 'Réponse en 24h' : lang === 'pt' ? 'Resposta em 24h' : 'Response within 24h',
    swirlIntensity: 0.9,
    swirlRadius: 500,
    swirlFrequency: 0.4
  },
  {
    id: 'linkedin',
    icon: 'linkedin',
    href: linkedin,
    label: 'LinkedIn',
    value: 'Angela Parra',
    color: '#93c5fd',
    description: lang === 'es' ? 'Conectemos profesionalmente' : lang === 'fr' ? 'Connectons-nous' : lang === 'pt' ? 'Vamos conectar' : 'Let\'s connect professionally',
    external: true,
    swirlIntensity: 0.75,
    swirlRadius: 450,
    swirlFrequency: 0.3
  },
  {
    id: 'resume',
    icon: 'document',
    href: `/${lang}/resume`,
    label: t(lang, 'contact.downloadPdf'),
    value: 'CV / Resume',
    color: '#c4b5fd',
    description: lang === 'es' ? 'Ver experiencia completa' : lang === 'fr' ? 'Voir expérience complète' : lang === 'pt' ? 'Ver experiência completa' : 'View full experience',
    swirlIntensity: 0.65,
    swirlRadius: 400,
    swirlFrequency: 0.25
  }
];
---

<section class="section relative overflow-hidden" id="contact">
  <!-- Background decorations -->
  <div class="absolute inset-0 pointer-events-none">
    <div class="absolute top-0 left-1/4 w-96 h-96 bg-emerald-500/5 rounded-full blur-3xl"></div>
    <div class="absolute bottom-0 right-1/4 w-80 h-80 bg-blue-500/5 rounded-full blur-3xl"></div>
    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[600px] h-[600px] bg-violet-500/3 rounded-full blur-3xl"></div>
  </div>

  <!-- Decorative grid pattern -->
  <div class="absolute inset-0 opacity-[0.02] pointer-events-none">
    <div class="absolute inset-0" style="background-image: radial-gradient(circle at 1px 1px, currentColor 1px, transparent 0); background-size: 40px 40px;"></div>
  </div>

  <div class="container relative z-10">
    <!-- Header -->
    <div class="text-center mb-16 reveal-element opacity-0 translate-y-6 transition-all duration-1000">
      <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-accent/10 text-accent text-sm font-medium mb-6">
        <span class="relative flex h-2 w-2">
          <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-accent opacity-75"></span>
          <span class="relative inline-flex rounded-full h-2 w-2 bg-accent"></span>
        </span>
        {lang === 'es' ? 'Disponible para nuevos proyectos' : lang === 'fr' ? 'Disponible pour nouveaux projets' : lang === 'pt' ? 'Disponível para novos projetos' : 'Available for new projects'}
      </div>

      <h2 class="text-4xl md:text-5xl font-bold text-foreground mb-4">
        {t(lang, 'contact.title')}
      </h2>
      <p class="text-lg text-muted max-w-2xl mx-auto">
        {t(lang, 'contact.subtitle')}
      </p>
    </div>

    <!-- Contact Cards Grid -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-5xl mx-auto mb-16">
      {contactMethods.map((method, index) => (
        <div 
          class="contact-card-wrapper reveal-element opacity-0 translate-y-6 transition-all duration-1000"
          style={`transition-delay: ${(index + 1) * 200}ms;`}
        >
          <LiquidSwirl 
            intensity={method.swirlIntensity} 
            radius={method.swirlRadius}
            color={`rgba(${parseInt(method.color.slice(1,3), 16)}, ${parseInt(method.color.slice(3,5), 16)}, ${parseInt(method.color.slice(5,7), 16)}, 0.5)`}
          >
            <a
              href={method.href}
              target={method.external ? '_blank' : undefined}
              rel={method.external ? 'noopener noreferrer' : undefined}
              class="contact-card group relative block h-full"
              style={`--spot-color: ${method.color};`}
              data-card-id={method.id}
            >

          <!-- Gradient border on hover -->
          <div
            class="absolute inset-0 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-500 p-[1px]"
            style={`background: linear-gradient(135deg, ${method.color}, transparent 60%)`}
          >
            <div class="w-full h-full rounded-2xl bg-surface"></div>
          </div>

          <!-- Card content -->
          <div class="contact-card-inner relative p-8 rounded-2xl bg-surface border border-border group-hover:border-transparent transition-all duration-500 group-hover:shadow-2xl h-full">
            <!-- Ripple container -->
            <div class="ripple-container absolute inset-0 rounded-2xl overflow-hidden pointer-events-none"></div>
            
            <!-- Icon -->
            <div
              class="contact-icon w-16 h-16 rounded-2xl flex items-center justify-center mb-6 transition-all duration-500 group-hover:scale-110 group-hover:rotate-3"
              style={`background: linear-gradient(135deg, ${method.color}30, ${method.color}10)`}
            >
              {method.icon === 'mail' && (
                <svg class="w-8 h-8 transition-colors duration-300" style={`color: ${method.color}`} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                </svg>
              )}
              {method.icon === 'linkedin' && (
                <svg class="w-8 h-8 transition-colors duration-300" style={`color: ${method.color}`} fill="currentColor" viewBox="0 0 24 24">
                  <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/>
                </svg>
              )}
              {method.icon === 'document' && (
                <svg class="w-8 h-8 transition-colors duration-300" style={`color: ${method.color}`} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
              )}
            </div>

            <!-- Label -->
            <h3 class="text-xl font-bold text-foreground mb-2 group-hover:text-accent transition-colors duration-300">
              {method.label}
            </h3>

            <!-- Description -->
            <p class="text-sm text-muted mb-4">
              {method.description}
            </p>

            <!-- Arrow indicator -->
            <div class="flex items-center gap-2 text-sm font-medium" style={`color: ${method.color}`}>
              <span>{method.external ? (lang === 'es' ? 'Abrir' : lang === 'fr' ? 'Ouvrir' : lang === 'pt' ? 'Abrir' : 'Open') : (lang === 'es' ? 'Ir' : lang === 'fr' ? 'Aller' : lang === 'pt' ? 'Ir' : 'Go')}</span>
              <svg class="w-4 h-4 transform group-hover:translate-x-1 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
              </svg>
            </div>

            <!-- Decorative corner -->
            <div
              class="absolute top-0 right-0 w-24 h-24 opacity-0 group-hover:opacity-20 transition-opacity duration-500 rounded-tr-2xl"
              style={`background: radial-gradient(circle at top right, ${method.color}, transparent 70%)`}
            ></div>
            
            <!-- Ambient glow -->
            <div
              class="card-glow absolute -inset-4 rounded-3xl opacity-0 group-hover:opacity-30 blur-2xl transition-opacity duration-700 pointer-events-none -z-10"
              style={`background: radial-gradient(circle, ${method.color}40, transparent 70%)`}
            ></div>
          </div>
            </a>
          </LiquidSwirl>
        </div>
      ))}
    </div>

    <!-- Location & Availability Info -->
    <div class="max-w-4xl mx-auto reveal-element opacity-0 translate-y-6 transition-all duration-1000" style="transition-delay: 800ms">
      <div class="relative p-8 rounded-3xl bg-gradient-to-br from-surface to-background border border-border overflow-hidden">
        <!-- Background pattern -->
        <div class="absolute inset-0 opacity-5">
        <div class="absolute inset-0" style="background-image: url('data:image/svg+xml,%3Csvg%20width%3D%2260%22%20height%3D%2260%22%20viewBox%3D%220%200%2060%2060%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%3E%3Cg%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%3E%3Cg%20fill%3D%22%23000%22%20fill-opacity%3D%220.4%22%3E%3Cpath%20d%3D%22M36%2034v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6%2034v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6%204V0H4v4H0v2h4v4h2V6h4V4H6z%22/%3E%3C/g%3E%3C/g%3E%3C/svg%3E'); background-size: 30px 30px;"></div>
        </div>

        <div class="relative flex flex-col md:flex-row items-center justify-between gap-8">
          <!-- Location -->
          <div class="flex items-center gap-4">
            <div class="w-14 h-14 rounded-full bg-gradient-to-br from-amber-200/30 to-amber-400/20 flex items-center justify-center">
              <svg class="w-7 h-7 text-amber-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
              </svg>
            </div>
            <div>
              <p class="text-sm text-muted mb-1">{lang === 'es' ? 'Ubicación' : lang === 'fr' ? 'Localisation' : lang === 'pt' ? 'Localização' : 'Location'}</p>
              <p class="font-semibold text-foreground">{location}</p>
            </div>
          </div>

          <!-- Divider -->
          <div class="hidden md:block w-px h-16 bg-border"></div>

          <!-- Timezone -->
          <div class="flex items-center gap-4">
            <div class="w-14 h-14 rounded-full bg-gradient-to-br from-blue-200/30 to-blue-400/20 flex items-center justify-center">
              <svg class="w-7 h-7 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </div>
            <div>
              <p class="text-sm text-muted mb-1">{lang === 'es' ? 'Zona horaria' : lang === 'fr' ? 'Fuseau horaire' : lang === 'pt' ? 'Fuso horário' : 'Timezone'}</p>
              <p class="font-semibold text-foreground">GMT-5 (COT)</p>
            </div>
          </div>

          <!-- Divider -->
          <div class="hidden md:block w-px h-16 bg-border"></div>

          <!-- Work preference -->
          <div class="flex items-center gap-4">
            <div class="w-14 h-14 rounded-full bg-gradient-to-br from-emerald-200/30 to-emerald-400/20 flex items-center justify-center">
              <svg class="w-7 h-7 text-emerald-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9" />
              </svg>
            </div>
            <div>
              <p class="text-sm text-muted mb-1">{lang === 'es' ? 'Preferencia' : lang === 'fr' ? 'Préférence' : lang === 'pt' ? 'Preferência' : 'Preference'}</p>
              <p class="font-semibold text-foreground">{lang === 'es' ? 'Remoto / Híbrido' : lang === 'fr' ? 'Télétravail / Hybride' : lang === 'pt' ? 'Remoto / Híbrido' : 'Remote / Hybrid'}</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick copy email -->
    <div class="mt-10 text-center reveal-element opacity-0 translate-y-6 transition-all duration-1000" style="transition-delay: 1000ms">
      <button
        id="copy-email-btn"
        data-email={email}
        class="inline-flex items-center gap-3 px-6 py-3 rounded-full bg-surface border border-border hover:border-accent/50 text-muted hover:text-foreground transition-all duration-300 group"
      >
        <svg class="w-5 h-5 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
        </svg>
        <span class="font-mono text-sm">{email}</span>
        <span class="text-xs px-2 py-1 rounded bg-accent/10 text-accent font-medium opacity-0 group-hover:opacity-100 transition-opacity">
          {t(lang, 'contact.copyEmail')}
        </span>
      </button>
      <p id="copy-feedback" class="mt-3 text-sm text-accent opacity-0 transition-opacity duration-300">
        {t(lang, 'contact.emailCopied')}
      </p>
    </div>
  </div>
</section>

<style>
  .contact-card-wrapper {
    perspective: 1000px;
    height: 100%;
  }

  .contact-card {
    display: block;
    text-decoration: none;
    height: 100%;
    transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .contact-card:hover {
    transform: translateY(-8px);
  }

  /* Icon animation */
  .contact-icon {
    position: relative;
    overflow: hidden;
  }

  .contact-icon::after {
    content: '';
    position: absolute;
    inset: -50%;
    background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.3) 50%, transparent 70%);
    transform: translateX(-100%);
    transition: transform 0.6s ease;
  }

  .contact-card:hover .contact-icon::after {
    transform: translateX(100%);
  }

  /* Ripple effect */
  .ripple-container {
    z-index: 0;
  }

  @keyframes ripple {
    0% {
      transform: scale(0);
      opacity: 1;
    }
    100% {
      transform: scale(2.5);
      opacity: 0;
    }
  }

  .ripple {
    position: absolute;
    border-radius: 50%;
    background: radial-gradient(circle, var(--spot-color), transparent);
    pointer-events: none;
    animation: ripple 0.8s ease-out;
  }

  /* Ambient glow */
  .card-glow {
    transition: opacity 0.7s ease;
  }

  /* Text tint on hover aligned to card color */
  .contact-card:hover h3 {
    color: var(--spot-color);
    text-shadow: 0 0 20px color-mix(in srgb, var(--spot-color) 30%, transparent);
  }

  .contact-card:hover p {
    color: color-mix(in srgb, var(--spot-color) 45%, var(--color-foreground, #111827) 55%);
  }

  /* Enhanced border glow on hover */
  .contact-card::after {
    content: '';
    position: absolute;
    inset: -2px;
    border-radius: 1rem;
    padding: 2px;
    background: linear-gradient(
      135deg,
      transparent 20%,
      color-mix(in srgb, var(--spot-color) 70%, transparent) 50%,
      transparent 80%
    );
    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
    opacity: 0;
    transition: opacity 0.5s ease;
    pointer-events: none;
    filter: blur(1px);
  }

  .contact-card:hover::after {
    opacity: 1;
    animation: borderPulse 2s ease-in-out infinite;
  }

  @keyframes borderPulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
  }

  /* Enhanced shadow on hover */
  .contact-card:hover .contact-card-inner {
    box-shadow:
      0 25px 50px -12px rgba(0, 0, 0, 0.15),
      0 0 60px -15px var(--spot-color);
  }

  /* Focus state for accessibility */
  .contact-card:focus-visible {
    outline: 2px solid var(--spot-color);
    outline-offset: 4px;
    transform: translateY(-8px);
  }

  .contact-card:focus-visible::after {
    opacity: 1;
    animation: borderPulse 1s ease-in-out infinite;
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .contact-card:hover {
      transform: none;
    }
    .animate-ping {
      animation: none;
    }
    .ripple {
      display: none;
    }
    .card-glow {
      display: none;
    }
  }
</style>

<script>
  // Ripple Effect on Click
  function initRippleEffect() {
    const cards = document.querySelectorAll('.contact-card');
    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

    if (prefersReducedMotion) return;

    cards.forEach((card) => {
      card.addEventListener('click', (e) => {
        const rippleContainer = card.querySelector('.ripple-container');
        if (!rippleContainer) return;

        const rect = card.getBoundingClientRect();
        const x = (e as MouseEvent).clientX - rect.left;
        const y = (e as MouseEvent).clientY - rect.top;

        const ripple = document.createElement('div');
        ripple.className = 'ripple';
        ripple.style.left = `${x}px`;
        ripple.style.top = `${y}px`;
        ripple.style.width = '20px';
        ripple.style.height = '20px';
        ripple.style.marginLeft = '-10px';
        ripple.style.marginTop = '-10px';

        rippleContainer.appendChild(ripple);

        setTimeout(() => {
          ripple.remove();
        }, 800);
      });
    });
  }

  // Initialize on load
  if (typeof document !== 'undefined') {
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initRippleEffect);
    } else {
      initRippleEffect();
    }

    // Reinitialize after view transitions
    document.addEventListener('astro:page-load', initRippleEffect);
  }
</script>
