---
/**
 * Case Study Detail Page
 * Individual case study with full details
 */

import Page from '@/layouts/Page.astro';
import { supportedLangs, type Lang, isValidLang } from '@/i18n/config';
import { t } from '@/i18n';
import { casesData, caseSlugs, type CaseSlug } from '@/data/cases';

// Generate static paths
export function getStaticPaths() {
  const paths = [];
  for (const lang of supportedLangs) {
    for (const slug of caseSlugs) {
      paths.push({ params: { lang, slug } });
    }
  }
  return paths;
}

const { lang, slug } = Astro.params;

// Validate
if (!isValidLang(lang!) || !slug || !(slug in casesData)) {
  return Astro.redirect(`/${lang || 'en'}/case-studies`);
}

const typedLang = lang as Lang;
const typedSlug = slug as CaseSlug;
const caseData = casesData[typedSlug][typedLang];

// Navigation
const currentIndex = caseSlugs.indexOf(typedSlug);
const prevCase = currentIndex > 0 ? caseSlugs[currentIndex - 1] : null;
const nextCase = currentIndex < caseSlugs.length - 1 ? caseSlugs[currentIndex + 1] : null;
---

<Page
  title={`${caseData.title} | Angela Parra Sanchez`}
  description={caseData.problem.slice(0, 160)}
  lang={typedLang}
  ogType="article"
>
  <article class="section">
    <div class="container max-w-4xl">
      <!-- Breadcrumb -->
      <nav class="mb-8">
        <a href={`/${typedLang}/case-studies`} class="text-sm text-muted hover:text-accent transition-colors">
          &larr; {t(typedLang, 'cases.detail.backToIndex')}
        </a>
      </nav>

      <!-- Header -->
      <header class="mb-12 pb-8 border-b border-border">
        <h1 class="text-3xl md:text-4xl font-bold text-foreground mb-4">{caseData.title}</h1>

        <div class="flex flex-wrap gap-4 text-sm text-muted">
          <span><strong class="text-foreground">{caseData.role}</strong></span>
          <span>-</span>
          <span>{caseData.org}</span>
          <span>-</span>
          <span>{caseData.timeframe}</span>
        </div>

        <div class="flex flex-wrap gap-2 mt-4">
          {caseData.regions.map((region) => (
            <span class="px-3 py-1 text-xs font-medium rounded-full bg-accent/10 text-accent">
              {region}
            </span>
          ))}
        </div>
      </header>

      <!-- Problem -->
      <section class="mb-10">
        <h2 class="text-xl font-semibold text-foreground mb-4">{t(typedLang, 'cases.detail.problem')}</h2>
        <p class="text-muted leading-relaxed">{caseData.problem}</p>
      </section>

      <!-- Approach -->
      <section class="mb-10">
        <h2 class="text-xl font-semibold text-foreground mb-4">{t(typedLang, 'cases.detail.approach')}</h2>
        <ul class="space-y-2">
          {caseData.approach.map((item) => (
            <li class="flex gap-3 text-muted">
              <span class="text-accent">-</span>
              <span>{item}</span>
            </li>
          ))}
        </ul>
      </section>

      <!-- System Design -->
      <section class="mb-10">
        <h2 class="text-xl font-semibold text-foreground mb-4">{t(typedLang, 'cases.detail.systemDesign')}</h2>
        <ul class="space-y-2">
          {caseData.systemDesign.map((item) => (
            <li class="flex gap-3 text-muted">
              <span class="text-accent">-</span>
              <span>{item}</span>
            </li>
          ))}
        </ul>
      </section>

      <!-- Data Sources -->
      <section class="mb-10">
        <h2 class="text-xl font-semibold text-foreground mb-4">{t(typedLang, 'cases.detail.dataSources')}</h2>
        <div class="flex flex-wrap gap-2">
          {caseData.dataSources.map((source) => (
            <span class="px-3 py-1 text-sm rounded-lg bg-background-alt text-muted">
              {source}
            </span>
          ))}
        </div>
      </section>

      <!-- Outputs -->
      <section class="mb-10">
        <h2 class="text-xl font-semibold text-foreground mb-4">{t(typedLang, 'cases.detail.outputs')}</h2>
        <ul class="space-y-2">
          {caseData.outputs.map((item) => (
            <li class="flex gap-3 text-muted">
              <span class="text-accent">-</span>
              <span>{item}</span>
            </li>
          ))}
        </ul>
      </section>

      <!-- Decision Impact -->
      <section class="mb-10 p-6 rounded-xl bg-accent/5 border border-accent/20">
        <h2 class="text-xl font-semibold text-foreground mb-4">{t(typedLang, 'cases.detail.decisionImpact')}</h2>
        <ul class="space-y-3">
          {caseData.decisionImpact.map((item) => (
            <li class="flex gap-3 text-foreground">
              <span class="text-accent font-bold">&rarr;</span>
              <span>{item}</span>
            </li>
          ))}
        </ul>
      </section>

      <!-- Adoption -->
      <section class="mb-10">
        <h2 class="text-xl font-semibold text-foreground mb-4">{t(typedLang, 'cases.detail.adoption')}</h2>
        <p class="text-muted leading-relaxed">{caseData.adoption}</p>
      </section>

      <!-- Governance -->
      <section class="mb-10">
        <h2 class="text-xl font-semibold text-foreground mb-4">{t(typedLang, 'cases.detail.governance')}</h2>
        <p class="text-muted leading-relaxed">{caseData.governance}</p>
      </section>

      <!-- Tools -->
      <section class="mb-12">
        <h2 class="text-xl font-semibold text-foreground mb-4">{t(typedLang, 'cases.detail.tools')}</h2>
        <div class="flex flex-wrap gap-2">
          {caseData.tools.map((tool) => (
            <span class="px-3 py-1 text-sm rounded-lg bg-primary/5 text-primary">
              {tool}
            </span>
          ))}
        </div>
      </section>

      <!-- Navigation -->
      <nav class="flex items-center justify-between pt-8 border-t border-border">
        {prevCase ? (
          <a href={`/${typedLang}/case-studies/${prevCase}`} class="text-sm text-muted hover:text-accent transition-colors">
            &larr; {t(typedLang, 'cases.detail.prevCase')}
          </a>
        ) : <span />}

        {nextCase ? (
          <a href={`/${typedLang}/case-studies/${nextCase}`} class="text-sm text-muted hover:text-accent transition-colors">
            {t(typedLang, 'cases.detail.nextCase')} &rarr;
          </a>
        ) : <span />}
      </nav>
    </div>
  </article>
</Page>