---
/**
 * Header Component - PREMIUM EDITION
 * Features:
 * - Glassmorphism with aurora glow
 * - Magnetic navigation links with glow trail
 * - Animated logo with gradient shimmer
 * - Morphing hamburger menu
 * - Scroll-aware styling (shrink + blur intensify)
 * - Floating particles on hover
 * - Theme-adaptive colors
 * - Premium CTA with pulse effect
 */

import { type Lang, getLocalizedPath } from '@/i18n/config';
import { t } from '@/i18n';
import LangSwitch from '@/components/core/LangSwitch.astro';
import ThemeToggle from '@/components/core/ThemeToggle.astro';

export interface Props {
  lang: Lang;
  currentPath: string;
}

const { lang, currentPath } = Astro.props;

const normalizedPath = currentPath.endsWith('/') && currentPath.length > 1
  ? currentPath.slice(0, -1)
  : currentPath;
const homePath = `/${lang}`;
const isHome = normalizedPath === homePath;
const homeAnchor = (hash: string) => (isHome ? `#${hash}` : `${homePath}#${hash}`);

// Navigation items with icons
const navItems = [
  { key: 'systems', href: homeAnchor('systems'), icon: 'grid' },
  { key: 'caseStudies', href: `/${lang}/case-studies`, icon: 'folder' },
  { key: 'perspectives', href: `/${lang}/perspectives`, icon: 'lightbulb' },
  { key: 'contact', href: homeAnchor('contact'), icon: 'mail' },
];

// Icon SVG paths
const iconPaths: Record<string, string> = {
  grid: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zm10 0a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zm10 0a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/>',
  folder: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/>',
  lightbulb: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>',
  mail: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>',
};
---

<header class="nav-header fixed top-0 left-0 right-0 z-50" data-header>
  <!-- Aurora glow effect -->
  <div class="nav-aurora absolute inset-0 pointer-events-none overflow-hidden">
    <div class="nav-aurora-1"></div>
    <div class="nav-aurora-2"></div>
  </div>

  <!-- Glass background -->
  <div class="nav-glass absolute inset-0"></div>

  <!-- Shimmer line at bottom -->
  <div class="nav-shimmer-line absolute bottom-0 left-0 right-0 h-px"></div>

  <div class="container relative z-10">
    <nav class="flex items-center justify-between h-16 md:h-20 nav-content" data-nav-content>

      <!-- Logo / Name -->
      <a
        href={`/${lang}`}
        class="nav-logo group relative flex items-center gap-3"
        data-logo
      >
        <!-- Logo mark -->
        <div class="nav-logo-mark relative w-10 h-10 rounded-xl overflow-hidden">
          <div class="nav-logo-gradient absolute inset-0"></div>
          <div class="nav-logo-inner absolute inset-[2px] rounded-[10px] flex items-center justify-center">
            <span class="text-lg font-bold nav-logo-letter">A</span>
          </div>
          <!-- Shine effect -->
          <div class="nav-logo-shine absolute inset-0 pointer-events-none"></div>
        </div>

        <!-- Name with shimmer -->
        <div class="nav-logo-text relative">
          <span class="font-display font-semibold text-lg nav-logo-name">
            Angela Parra
          </span>
          <!-- Gradient overlay on hover -->
          <span class="nav-logo-gradient-text absolute inset-0 font-display font-semibold text-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300">
            Angela Parra
          </span>
        </div>

        <!-- Floating particles on hover -->
        <div class="nav-logo-particles absolute -inset-4 pointer-events-none">
          {Array.from({ length: 6 }).map((_, i) => (
            <div
              class="nav-particle absolute w-1 h-1 rounded-full opacity-0 group-hover:opacity-100"
              style={`--particle-index: ${i}`}
            />
          ))}
        </div>
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden md:flex items-center gap-1 lg:gap-2">
        <!-- Nav Links -->
        <div class="nav-links-container relative flex items-center">
          <!-- Active indicator (moves) -->
          <div class="nav-active-indicator absolute h-8 rounded-lg pointer-events-none" data-nav-indicator></div>

          {navItems.map((item, index) => (
            <a
              href={item.href}
              class="nav-link group relative px-4 py-2 rounded-lg"
              data-nav-link
              data-index={index}
            >
              <!-- Hover glow -->
              <div class="nav-link-glow absolute inset-0 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>

              <!-- Content -->
              <span class="relative flex items-center gap-2 text-sm font-medium nav-link-text">
                <svg class="w-4 h-4 nav-link-icon opacity-0 group-hover:opacity-100 transition-all duration-300 -translate-x-1 group-hover:translate-x-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <Fragment set:html={iconPaths[item.icon]} />
                </svg>
                <span>{t(lang, `nav.${item.key}`)}</span>
              </span>

              <!-- Underline effect -->
              <div class="nav-link-underline absolute bottom-1 left-4 right-4 h-0.5 rounded-full scale-x-0 group-hover:scale-x-100 transition-transform duration-300 origin-left"></div>
            </a>
          ))}
        </div>

        <!-- Divider -->
        <div class="nav-divider w-px h-8 mx-3"></div>

        <!-- Controls -->
        <div class="flex items-center gap-2">
          <ThemeToggle lang={lang} />
          <LangSwitch currentLang={lang} currentPath={currentPath} />
        </div>

        <!-- Divider -->
        <div class="nav-divider w-px h-8 mx-3"></div>

        <!-- Resume CTA -->
        <a
          href={`/${lang}/resume`}
          class="nav-cta group relative inline-flex items-center justify-center px-5 py-2.5 rounded-xl overflow-hidden"
          data-cta
        >
          <!-- Animated gradient background -->
          <div class="nav-cta-bg absolute inset-0"></div>

          <!-- Shimmer effect -->
          <div class="nav-cta-shimmer absolute inset-0 pointer-events-none"></div>

          <!-- Border glow -->
          <div class="nav-cta-glow absolute -inset-[1px] rounded-xl opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>

          <!-- Content -->
          <span class="relative flex items-center gap-2 text-sm font-semibold text-white">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
            </svg>
            <span>{t(lang, 'nav.resume')}</span>
          </span>

          <!-- Pulse rings -->
          <div class="nav-cta-pulse absolute inset-0 rounded-xl"></div>
        </a>
      </div>

      <!-- Mobile Menu Button -->
      <div class="flex items-center gap-3 md:hidden">
        <ThemeToggle lang={lang} />

        <button
          type="button"
          class="nav-mobile-toggle group relative w-10 h-10 rounded-xl flex items-center justify-center"
          aria-label={t(lang, 'a11y.menuToggle')}
          data-menu-toggle
        >
          <!-- Button background -->
          <div class="nav-toggle-bg absolute inset-0 rounded-xl"></div>

          <!-- Hamburger lines (morphing) -->
          <div class="nav-hamburger relative w-5 h-4 flex flex-col justify-between">
            <span class="nav-hamburger-line nav-hamburger-1 w-full h-0.5 rounded-full origin-left transition-all duration-300"></span>
            <span class="nav-hamburger-line nav-hamburger-2 w-3/4 h-0.5 rounded-full transition-all duration-300"></span>
            <span class="nav-hamburger-line nav-hamburger-3 w-1/2 h-0.5 rounded-full origin-left transition-all duration-300"></span>
          </div>
        </button>
      </div>
    </nav>
  </div>

  <!-- Mobile Menu -->
  <div
    class="nav-mobile-menu md:hidden fixed inset-x-0 top-16 bottom-0 pointer-events-none opacity-0 translate-y-[-10px]"
    data-mobile-menu
  >
    <!-- Backdrop -->
    <div class="nav-mobile-backdrop absolute inset-0"></div>

    <!-- Menu Content -->
    <div class="nav-mobile-content relative h-full overflow-y-auto">
      <div class="container py-8 space-y-6">
        <!-- Mobile Nav Links -->
        {navItems.map((item, index) => (
          <a
            href={item.href}
            class="nav-mobile-link group flex items-center gap-4 py-4 border-b nav-mobile-border"
            style={`--mobile-index: ${index}`}
          >
            <div class="nav-mobile-icon w-12 h-12 rounded-2xl flex items-center justify-center">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <Fragment set:html={iconPaths[item.icon]} />
              </svg>
            </div>
            <div class="flex-1">
              <span class="text-lg font-semibold nav-mobile-text block">
                {t(lang, `nav.${item.key}`)}
              </span>
            </div>
            <svg class="w-5 h-5 nav-mobile-arrow opacity-0 group-hover:opacity-100 transition-all duration-300 translate-x-[-10px] group-hover:translate-x-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
          </a>
        ))}

        <!-- Resume CTA Mobile -->
        <a
          href={`/${lang}/resume`}
          class="nav-mobile-cta flex items-center justify-center gap-3 py-4 rounded-2xl mt-8"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
          </svg>
          <span class="text-lg font-semibold">{t(lang, 'nav.resume')}</span>
        </a>

        <!-- Language Switch Mobile -->
        <div class="pt-8 border-t nav-mobile-border">
          <p class="text-sm nav-mobile-label mb-4">{t(lang, 'a11y.languageSwitch')}</p>
          <LangSwitch currentLang={lang} currentPath={currentPath} />
        </div>
      </div>
    </div>
  </div>
</header>

<style>
  /* === HEADER BASE === */
  .nav-header {
    --nav-height: 4rem;
    --nav-height-scrolled: 3.5rem;
  }

  @media (min-width: 768px) {
    .nav-header {
      --nav-height: 5rem;
      --nav-height-scrolled: 4rem;
    }
  }

  /* === GLASS BACKGROUND === */
  .nav-glass {
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);
    border-bottom: 1px solid rgba(0, 0, 0, 0.06);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  :global(.dark) .nav-glass {
    background: rgba(15, 23, 42, 0.8);
    border-bottom-color: rgba(255, 255, 255, 0.08);
  }

  .nav-header.is-scrolled .nav-glass {
    background: rgba(255, 255, 255, 0.85);
    backdrop-filter: blur(30px) saturate(200%);
    -webkit-backdrop-filter: blur(30px) saturate(200%);
  }

  :global(.dark) .nav-header.is-scrolled .nav-glass {
    background: rgba(15, 23, 42, 0.9);
  }

  /* === AURORA GLOW === */
  .nav-aurora-1,
  .nav-aurora-2 {
    position: absolute;
    width: 300px;
    height: 100px;
    border-radius: 50%;
    filter: blur(60px);
    opacity: 0;
    transition: opacity 0.5s ease;
  }

  .nav-header:hover .nav-aurora-1,
  .nav-header:hover .nav-aurora-2 {
    opacity: 0.3;
  }

  :global(.dark) .nav-header:hover .nav-aurora-1,
  :global(.dark) .nav-header:hover .nav-aurora-2 {
    opacity: 0.4;
  }

  .nav-aurora-1 {
    background: radial-gradient(ellipse, rgba(110, 231, 183, 0.6) 0%, transparent 70%);
    top: -50px;
    left: 10%;
    animation: nav-aurora-drift 8s ease-in-out infinite;
  }

  .nav-aurora-2 {
    background: radial-gradient(ellipse, rgba(147, 197, 253, 0.6) 0%, transparent 70%);
    top: -50px;
    right: 10%;
    animation: nav-aurora-drift 10s ease-in-out infinite reverse;
  }

  @keyframes nav-aurora-drift {
    0%, 100% { transform: translateX(0) scale(1); }
    50% { transform: translateX(30px) scale(1.1); }
  }

  /* === SHIMMER LINE === */
  .nav-shimmer-line {
    background: linear-gradient(
      90deg,
      transparent 0%,
      rgba(110, 231, 183, 0.3) 25%,
      rgba(147, 197, 253, 0.3) 50%,
      rgba(196, 181, 253, 0.3) 75%,
      transparent 100%
    );
    background-size: 200% 100%;
    animation: nav-shimmer 6s linear infinite;
    opacity: 0.5;
  }

  :global(.dark) .nav-shimmer-line {
    opacity: 0.8;
  }

  @keyframes nav-shimmer {
    0% { background-position: -200% 0; }
    100% { background-position: 200% 0; }
  }

  /* === LOGO === */
  .nav-logo-mark {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .nav-logo:hover .nav-logo-mark {
    transform: scale(1.05) rotate(-3deg);
    box-shadow: 0 8px 25px -5px rgba(110, 231, 183, 0.4);
  }

  .nav-logo-gradient {
    background: linear-gradient(135deg, #6ee7b7 0%, #3b82f6 50%, #8b5cf6 100%);
    animation: nav-logo-rotate 4s linear infinite;
  }

  @keyframes nav-logo-rotate {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  .nav-logo-inner {
    background: var(--color-surface);
  }

  .nav-logo-letter {
    background: linear-gradient(135deg, #6ee7b7, #3b82f6);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .nav-logo-shine {
    background: linear-gradient(
      115deg,
      transparent 0%,
      transparent 40%,
      rgba(255, 255, 255, 0.5) 50%,
      transparent 60%,
      transparent 100%
    );
    transform: translateX(-100%);
    transition: transform 0.6s ease;
  }

  .nav-logo:hover .nav-logo-shine {
    transform: translateX(100%);
  }

  .nav-logo-name {
    color: var(--color-text);
    transition: color 0.3s ease;
  }

  .nav-logo-gradient-text {
    background: linear-gradient(90deg, #6ee7b7, #3b82f6, #8b5cf6);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  /* Logo particles */
  .nav-particle {
    background: linear-gradient(135deg, #6ee7b7, #3b82f6);
    animation: nav-particle-float 2s ease-in-out infinite;
    animation-delay: calc(var(--particle-index) * 0.15s);
  }

  @keyframes nav-particle-float {
    0%, 100% {
      transform: translate(
        calc(20px * cos(var(--particle-index) * 60deg)),
        calc(20px * sin(var(--particle-index) * 60deg))
      ) scale(0);
    }
    50% {
      transform: translate(
        calc(30px * cos(var(--particle-index) * 60deg)),
        calc(30px * sin(var(--particle-index) * 60deg))
      ) scale(1);
    }
  }

  /* === NAV LINKS === */
  .nav-link {
    transition: all 0.3s ease;
  }

  .nav-link-text {
    color: var(--color-text-muted);
    transition: color 0.3s ease;
  }

  .nav-link:hover .nav-link-text {
    color: var(--color-text);
  }

  .nav-link-icon {
    color: var(--color-accent);
  }

  .nav-link-glow {
    background: radial-gradient(
      ellipse at center,
      rgba(110, 231, 183, 0.1) 0%,
      transparent 70%
    );
  }

  :global(.dark) .nav-link-glow {
    background: radial-gradient(
      ellipse at center,
      rgba(110, 231, 183, 0.15) 0%,
      transparent 70%
    );
  }

  .nav-link-underline {
    background: linear-gradient(90deg, #6ee7b7, #3b82f6);
  }

  /* Active indicator */
  .nav-active-indicator {
    background: rgba(110, 231, 183, 0.1);
    border: 1px solid rgba(110, 231, 183, 0.2);
    opacity: 0;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* === DIVIDER === */
  .nav-divider {
    background: linear-gradient(
      180deg,
      transparent 0%,
      var(--color-border) 30%,
      var(--color-border) 70%,
      transparent 100%
    );
  }

  /* === CTA BUTTON === */
  .nav-cta-bg {
    background: linear-gradient(135deg, #6ee7b7 0%, #3b82f6 50%, #8b5cf6 100%);
    background-size: 200% 200%;
    animation: nav-cta-gradient 4s ease infinite;
  }

  @keyframes nav-cta-gradient {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
  }

  .nav-cta-shimmer {
    background: linear-gradient(
      110deg,
      transparent 0%,
      transparent 40%,
      rgba(255, 255, 255, 0.3) 50%,
      transparent 60%,
      transparent 100%
    );
    transform: translateX(-100%);
    animation: nav-cta-shimmer 3s ease-in-out infinite;
  }

  @keyframes nav-cta-shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }

  .nav-cta-glow {
    background: linear-gradient(135deg, #6ee7b7 0%, #3b82f6 50%, #8b5cf6 100%);
    filter: blur(8px);
  }

  .nav-cta-pulse {
    animation: nav-cta-pulse 2s ease-in-out infinite;
  }

  @keyframes nav-cta-pulse {
    0%, 100% {
      box-shadow: 0 0 0 0 rgba(110, 231, 183, 0.4);
    }
    50% {
      box-shadow: 0 0 0 8px rgba(110, 231, 183, 0);
    }
  }

  .nav-cta {
    box-shadow:
      0 4px 15px -3px rgba(110, 231, 183, 0.3),
      0 2px 6px -2px rgba(59, 130, 246, 0.2);
    transition: all 0.3s ease;
  }

  .nav-cta:hover {
    transform: translateY(-2px);
    box-shadow:
      0 8px 25px -5px rgba(110, 231, 183, 0.4),
      0 4px 10px -4px rgba(59, 130, 246, 0.3);
  }

  /* === MOBILE TOGGLE === */
  .nav-toggle-bg {
    background: rgba(0, 0, 0, 0.03);
    border: 1px solid rgba(0, 0, 0, 0.06);
    transition: all 0.3s ease;
  }

  :global(.dark) .nav-toggle-bg {
    background: rgba(255, 255, 255, 0.05);
    border-color: rgba(255, 255, 255, 0.1);
  }

  .nav-mobile-toggle:hover .nav-toggle-bg {
    background: rgba(110, 231, 183, 0.1);
    border-color: rgba(110, 231, 183, 0.3);
  }

  .nav-hamburger-line {
    background: var(--color-text);
  }

  /* Morphing hamburger to X */
  .nav-mobile-toggle.is-open .nav-hamburger-1 {
    transform: rotate(45deg) translateY(6px);
    width: 100%;
  }

  .nav-mobile-toggle.is-open .nav-hamburger-2 {
    opacity: 0;
    transform: translateX(10px);
  }

  .nav-mobile-toggle.is-open .nav-hamburger-3 {
    transform: rotate(-45deg) translateY(-6px);
    width: 100%;
  }

  /* === MOBILE MENU === */
  .nav-mobile-menu {
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .nav-mobile-menu.is-open {
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
  }

  .nav-mobile-backdrop {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(30px);
    -webkit-backdrop-filter: blur(30px);
  }

  :global(.dark) .nav-mobile-backdrop {
    background: rgba(15, 23, 42, 0.95);
  }

  .nav-mobile-border {
    border-color: var(--color-border);
  }

  .nav-mobile-icon {
    background: rgba(110, 231, 183, 0.1);
    color: var(--color-accent);
    transition: all 0.3s ease;
  }

  .nav-mobile-link:hover .nav-mobile-icon {
    background: rgba(110, 231, 183, 0.2);
    transform: scale(1.05);
  }

  .nav-mobile-text {
    color: var(--color-text);
  }

  .nav-mobile-arrow {
    color: var(--color-accent);
  }

  .nav-mobile-cta {
    background: linear-gradient(135deg, #6ee7b7 0%, #3b82f6 100%);
    color: white;
    box-shadow: 0 8px 25px -5px rgba(110, 231, 183, 0.4);
    transition: all 0.3s ease;
  }

  .nav-mobile-cta:hover {
    transform: scale(1.02);
    box-shadow: 0 12px 30px -5px rgba(110, 231, 183, 0.5);
  }

  .nav-mobile-label {
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.1em;
  }

  /* Mobile link stagger animation */
  .nav-mobile-link {
    opacity: 0;
    transform: translateX(-20px);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    transition-delay: calc(var(--mobile-index) * 0.08s);
  }

  .nav-mobile-menu.is-open .nav-mobile-link {
    opacity: 1;
    transform: translateX(0);
  }

  /* === SCROLL STATE === */
  .nav-content {
    transition: height 0.3s ease;
  }

  .nav-header.is-scrolled .nav-content {
    height: var(--nav-height-scrolled);
  }

  .nav-header.is-scrolled .nav-logo-mark {
    transform: scale(0.9);
  }

  /* === REDUCED MOTION === */
  @media (prefers-reduced-motion: reduce) {
    .nav-aurora-1,
    .nav-aurora-2,
    .nav-shimmer-line,
    .nav-logo-gradient,
    .nav-cta-shimmer,
    .nav-cta-pulse,
    .nav-particle {
      animation: none !important;
    }

    .nav-glass,
    .nav-logo-mark,
    .nav-logo-shine,
    .nav-link,
    .nav-cta,
    .nav-hamburger-line,
    .nav-mobile-menu,
    .nav-mobile-link {
      transition: none !important;
    }
  }
</style>

<script>
  import { initOnce } from '@/lib/lifecycle';

  function initHeader() {
    const header = document.querySelector('[data-header]') as HTMLElement;
    initOnce(header, 'header', (root) => {
      const menuToggle = root.querySelector('[data-menu-toggle]') as HTMLElement | null;
      const mobileMenu = root.querySelector('[data-mobile-menu]') as HTMLElement | null;
      const navLinks = root.querySelectorAll('[data-nav-link]');
      const navIndicator = root.querySelector('[data-nav-indicator]') as HTMLElement | null;
      const logo = root.querySelector('[data-logo]') as HTMLElement | null;
      const cta = root.querySelector('[data-cta]') as HTMLElement | null;
      const disposers: Array<() => void> = [];

      const on = (
        target: EventTarget,
        event: string,
        handler: (e: Event) => void,
        options?: AddEventListenerOptions
      ) => {
        target.addEventListener(event, handler, options);
        disposers.push(() => target.removeEventListener(event, handler, options));
      };

      // === SCROLL BEHAVIOR ===
      const scrollThreshold = 50;
      const handleScroll = () => {
        const currentScroll = window.scrollY;
        if (currentScroll > scrollThreshold) {
          root.classList.add('is-scrolled');
        } else {
          root.classList.remove('is-scrolled');
        }
      };

      on(window, 'scroll', handleScroll, { passive: true });
      handleScroll();

      // === MOBILE MENU TOGGLE ===
      if (menuToggle && mobileMenu) {
        const toggleMenu = () => {
          const isOpen = mobileMenu.classList.contains('is-open');
          if (isOpen) {
            mobileMenu.classList.remove('is-open');
            menuToggle.classList.remove('is-open');
            document.body.style.overflow = '';
          } else {
            mobileMenu.classList.add('is-open');
            menuToggle.classList.add('is-open');
            document.body.style.overflow = 'hidden';
          }
        };

        on(menuToggle, 'click', toggleMenu);

        mobileMenu.querySelectorAll('a').forEach((link) => {
          const closeMenu = () => {
            mobileMenu.classList.remove('is-open');
            menuToggle.classList.remove('is-open');
            document.body.style.overflow = '';
          };
          on(link, 'click', closeMenu);
        });
      }

      // === NAV LINK HOVER INDICATOR ===
      if (navIndicator && navLinks.length > 0) {
        const moveIndicator = (link: Element) => {
          const rect = (link as HTMLElement).getBoundingClientRect();
          const containerRect = link.parentElement?.getBoundingClientRect();
          if (!containerRect) return;

          navIndicator.style.width = `${rect.width}px`;
          navIndicator.style.left = `${rect.left - containerRect.left}px`;
          navIndicator.style.opacity = '1';
        };

        const hideIndicator = () => {
          navIndicator.style.opacity = '0';
        };

        navLinks.forEach((link) => {
          on(link, 'mouseenter', () => moveIndicator(link));
        });

        const container = (navLinks[0] as HTMLElement | undefined)?.parentElement;
        if (container) {
          on(container, 'mouseleave', hideIndicator);
        }
      }

      // === MAGNETIC EFFECT ON LINKS ===
      const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      const hasFinePointer = window.matchMedia('(pointer: fine)').matches;

      if (!prefersReducedMotion && hasFinePointer) {
        navLinks.forEach((link) => {
          const el = link as HTMLElement;
          const handleMove = (e: Event) => {
            const mouseEvent = e as MouseEvent;
            const rect = el.getBoundingClientRect();
            const x = mouseEvent.clientX - rect.left - rect.width / 2;
            const y = mouseEvent.clientY - rect.top - rect.height / 2;
            el.style.transform = `translate(${x * 0.1}px, ${y * 0.1}px)`;
          };
          const handleLeave = () => {
            el.style.transform = 'translate(0, 0)';
          };
          on(el, 'mousemove', handleMove);
          on(el, 'mouseleave', handleLeave);
        });

        if (cta) {
          const handleMove = (e: Event) => {
            const mouseEvent = e as MouseEvent;
            const rect = cta.getBoundingClientRect();
            const x = mouseEvent.clientX - rect.left - rect.width / 2;
            const y = mouseEvent.clientY - rect.top - rect.height / 2;
            cta.style.transform = `translate(${x * 0.08}px, ${y * 0.08}px) translateY(-2px)`;
          };
          const handleLeave = () => {
            cta.style.transform = 'translate(0, 0)';
          };
          on(cta, 'mousemove', handleMove);
          on(cta, 'mouseleave', handleLeave);
        }

        if (logo) {
          const handleMove = (e: Event) => {
            const mouseEvent = e as MouseEvent;
            const rect = logo.getBoundingClientRect();
            const x = mouseEvent.clientX - rect.left - rect.width / 2;
            const y = mouseEvent.clientY - rect.top - rect.height / 2;
            logo.style.transform = `translate(${x * 0.05}px, ${y * 0.05}px)`;
          };
          const handleLeave = () => {
            logo.style.transform = 'translate(0, 0)';
          };
          on(logo, 'mousemove', handleMove);
          on(logo, 'mouseleave', handleLeave);
        }
      }

      return () => {
        disposers.forEach((dispose) => dispose());
        if (mobileMenu) mobileMenu.classList.remove('is-open');
        if (menuToggle) menuToggle.classList.remove('is-open');
        document.body.style.overflow = '';
      };
    });
  }

  initHeader();
  document.addEventListener('astro:page-load', initHeader);
</script>
