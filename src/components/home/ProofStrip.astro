---
import { t } from '@/i18n';
import type { Lang } from '@/i18n/config';

interface Props {
  lang: Lang;
  items: Array<{
    href: string;
    title: { [key: string]: string } | string;
    detail: { [key: string]: string } | string;
  }>;
}

const { lang, items } = Astro.props;

// Helper to get localized string
const getStr = (obj: any) => (typeof obj === 'string' ? obj : obj[lang]);

function resolveHref(href: string) {
  if (href.startsWith('#')) return href;
  if (href.startsWith('/')) return `/${lang}${href}`;
  return href;
}
---

<section class="section bg-background-alt" id="proof">
  <div class="container">
    <h2 class="text-xs font-semibold text-muted uppercase tracking-wider mb-6 reveal-element">
      {t(lang, 'proof.title')}
    </h2>
    <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4 stagger-container">
      {items.map((item, index) => (
        <a
          href={resolveHref(item.href)}
          class="group p-4 rounded-lg bg-surface border border-border hover:border-accent hover:shadow-md transition-all reveal-element opacity-0 translate-y-4"
          style={`transition-delay: ${index * 100}ms`}
        >
          <div class="flex items-center justify-between mb-2">
            <p class="text-sm font-semibold text-foreground group-hover:text-accent transition-colors">
              {getStr(item.title)}
            </p>
            <span class="text-xs text-muted group-hover:text-accent transition-colors">+</span>
          </div>
          <p class="text-sm text-muted mt-1 leading-relaxed">
            {getStr(item.detail)}
          </p>
        </a>
      ))}
    </div>
  </div>
</section>

<script>
  function initProofStrip() {
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.remove('opacity-0', 'translate-y-4');
          entry.target.classList.add('opacity-100', 'translate-y-0');
          observer.unobserve(entry.target);
        }
      });
    }, {
      threshold: 0.1,
      rootMargin: '50px'
    });

    document.querySelectorAll('#proof .reveal-element').forEach((el) => {
      observer.observe(el);
    });
  }

  // Initialize on load
  initProofStrip();

  // Re-initialize on view transitions
  document.addEventListener('astro:page-load', initProofStrip);
</script>
