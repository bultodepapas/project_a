---
/**
 * Languages Section - SOUNDWAVE UNIVERSE EDITION
 * Features:
 * - Central audio frequency visualizer
 * - Unique waveform signatures per language
 * - Connection threads between related languages
 * - Echo ripple effects on reveal
 * - Magnetic hover with sound pulse
 * - Frequency bars that animate uniquely
 * - Theme adaptive (light/dark)
 */

import { t } from '@/i18n';
import type { Lang } from '@/i18n/config';

interface Props {
  lang: Lang;
  items: Array<{
    id: string;
    name: string;
    level: string;
    usedFor: { [key: string]: string } | string;
  }>;
}

const { lang, items } = Astro.props;

// Helper to get localized string
const getStr = (obj: any) => (typeof obj === 'string' ? obj : obj[lang]);

// Level configurations with sound frequencies
const levelConfig: Record<string, {
  percent: number;
  frequency: string;
  color: string;
  colorLight: string;
  waveSpeed: number;
  label: string;
}> = {
  native: {
    percent: 100,
    frequency: 'high',
    color: '#6ee7b7',
    colorLight: '#059669',
    waveSpeed: 0.8,
    label: 'Native',
  },
  fluent: {
    percent: 90,
    frequency: 'mid-high',
    color: '#93c5fd',
    colorLight: '#2563eb',
    waveSpeed: 1,
    label: 'Fluent',
  },
  advanced: {
    percent: 75,
    frequency: 'mid',
    color: '#c4b5fd',
    colorLight: '#7c3aed',
    waveSpeed: 1.2,
    label: 'Advanced',
  },
  working: {
    percent: 60,
    frequency: 'low',
    color: '#fcd34d',
    colorLight: '#d97706',
    waveSpeed: 1.5,
    label: 'Working',
  },
};

// Flag data with phonetic greeting
const flagMap: Record<string, { emoji: string; greeting: string; phonetic: string }> = {
  english: { emoji: 'üá¨üáß', greeting: 'Hello', phonetic: '/h…ôÀàlo ä/' },
  spanish: { emoji: 'üá™üá∏', greeting: 'Hola', phonetic: '/Ààola/' },
  portuguese: { emoji: 'üáßüá∑', greeting: 'Ol√°', phonetic: '/oÀàla/' },
  french: { emoji: 'üá´üá∑', greeting: 'Bonjour', phonetic: '/b…îÃÉÀà íu Å/' },
};

// Language connections (related languages)
const connections = [
  { from: 'spanish', to: 'portuguese', strength: 0.9 },
  { from: 'spanish', to: 'french', strength: 0.6 },
  { from: 'english', to: 'french', strength: 0.4 },
];
---

<section class="lang-section section relative overflow-hidden" id="languages">
  <!-- Echo Ripple Background -->
  <div class="lang-ripple-container absolute inset-0 pointer-events-none flex items-center justify-center">
    <div class="lang-ripple lang-ripple-1"></div>
    <div class="lang-ripple lang-ripple-2"></div>
    <div class="lang-ripple lang-ripple-3"></div>
  </div>

  <!-- Frequency Grid Background -->
  <div class="lang-freq-grid absolute inset-0 pointer-events-none"></div>

  <!-- Sound Particles -->
  <div class="lang-sound-particles absolute inset-0 pointer-events-none overflow-hidden">
    {Array.from({ length: 30 }).map((_, i) => (
      <div
        class="lang-sound-particle absolute"
        style={`
          left: ${5 + (i * 3.2) % 90}%;
          top: ${10 + (i * 5.7) % 80}%;
          animation-delay: ${(i % 8) * -0.5}s;
          --particle-size: ${2 + (i % 3)}px;
        `}
      />
    ))}
  </div>

  <div class="container relative z-10">
    <!-- Header with Central Visualizer -->
    <div class="text-center mb-16 lang-reveal relative z-10">
      <!-- Audio Visualizer Badge -->
      <div class="inline-flex flex-col items-center gap-4 mb-8">
        <!-- Main Frequency Visualizer -->
        <div class="lang-visualizer-container relative">
          <div class="lang-visualizer flex items-end justify-center gap-[3px] h-12 px-6 py-3 rounded-full lang-visualizer-bg backdrop-blur-xl">
            {Array.from({ length: 20 }).map((_, i) => (
              <div
                class="lang-freq-bar rounded-full"
                style={`
                  --bar-index: ${i};
                  --bar-delay: ${i * 0.05}s;
                  height: ${12 + Math.sin(i * 0.5) * 8 + Math.random() * 10}px;
                `}
              />
            ))}
          </div>
          <!-- Pulse ring around visualizer -->
          <div class="lang-pulse-ring absolute inset-[-8px] rounded-full"></div>
        </div>

        <span class="text-xs font-medium lang-badge-text tracking-[0.3em] uppercase">
          {t(lang, 'languages.subtitle') || 'Speaking Your Language'}
        </span>
      </div>

      <!-- Title -->
      <h2 class="text-4xl md:text-5xl font-bold lang-title mb-4">
        {t(lang, 'languages.title')}
      </h2>

      <p class="text-lg lang-subtitle max-w-2xl mx-auto">
        {t(lang, 'languages.subtitle') || 'Multilingual professional bridging cultures and ideas'}
      </p>
    </div>

    <div class="relative max-w-5xl mx-auto">
      <!-- Connection Lines SVG (behind cards) -->
      <div class="lang-connections-container absolute inset-0 pointer-events-none z-0">
        <svg class="lang-connections-svg w-full h-full" preserveAspectRatio="none">
          <defs>
            <linearGradient id="connection-gradient" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" style="stop-color:#6ee7b7;stop-opacity:0.6"/>
              <stop offset="50%" style="stop-color:#93c5fd;stop-opacity:0.8"/>
              <stop offset="100%" style="stop-color:#c4b5fd;stop-opacity:0.6"/>
            </linearGradient>
            <filter id="glow-filter">
              <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
              <feMerge>
                <feMergeNode in="coloredBlur"/>
                <feMergeNode in="SourceGraphic"/>
              </feMerge>
            </filter>
          </defs>
          <!-- Connection paths will be drawn by JS -->
        </svg>
      </div>

      <!-- Language Cards Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8 relative z-10" id="lang-cards-grid">
      {items.map((item, index) => {
        const config = levelConfig[item.level] || levelConfig.working;
        const flag = flagMap[item.id] || { emoji: 'üåê', greeting: 'Hello', phonetic: '' };

        return (
          <div
            class="lang-card-wrapper lang-reveal"
            data-language={item.id}
            data-index={index}
            style={`--card-index: ${index}; --accent: ${config.color}; --accent-light: ${config.colorLight};`}
          >
            <div class="lang-card group relative rounded-2xl overflow-hidden cursor-default">
              <!-- Card Background with Frequency Pattern -->
              <div class="absolute inset-0 lang-card-bg"></div>

              <!-- Waveform Background Pattern -->
              <div class="lang-waveform-bg absolute inset-0 opacity-20 pointer-events-none">
                <svg class="w-full h-full" preserveAspectRatio="none" viewBox="0 0 400 200">
                  <path
                    class="lang-waveform-path"
                    fill="none"
                    stroke={config.color}
                    stroke-width="1.5"
                    style={`--wave-speed: ${config.waveSpeed}s`}
                  />
                </svg>
              </div>

              <!-- Magnetic Glow Effect -->
              <div class="lang-magnetic-glow absolute inset-0 pointer-events-none opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>

              <!-- Card Content -->
              <div class="relative p-6 md:p-8 z-10">
                <div class="flex items-start gap-6">
                  <!-- Flag with Sound Pulse -->
                  <div class="relative flex-shrink-0">
                    <!-- Sound rings emanating from flag -->
                    <div class="lang-sound-rings absolute inset-0 flex items-center justify-center">
                      <div class="lang-sound-ring lang-sound-ring-1" style={`border-color: ${config.color}`}></div>
                      <div class="lang-sound-ring lang-sound-ring-2" style={`border-color: ${config.color}`}></div>
                    </div>

                    <!-- Flag Container -->
                    <div class="relative w-20 h-20 rounded-2xl lang-flag-container flex items-center justify-center">
                      <span class="text-5xl lang-flag-emoji group-hover:scale-110 transition-transform duration-300">
                        {flag.emoji}
                      </span>
                    </div>

                    <!-- Level Indicator (mini waveform) -->
                    <div class="absolute -bottom-2 -right-2 px-2 py-1 rounded-lg lang-level-badge flex items-center gap-1">
                      <div class="flex items-end gap-[2px] h-3">
                        {Array.from({ length: 4 }).map((_, i) => (
                          <div
                            class="lang-mini-bar w-[3px] rounded-full"
                            style={`
                              background: ${config.color};
                              height: ${i < Math.floor(config.percent / 25) ? 8 + i * 2 : 4}px;
                              opacity: ${i < Math.floor(config.percent / 25) ? 1 : 0.3};
                            `}
                          />
                        ))}
                      </div>
                    </div>
                  </div>

                  <!-- Language Details -->
                  <div class="flex-1 min-w-0">
                    <!-- Name and Greeting -->
                    <div class="mb-3">
                      <h3 class="text-xl md:text-2xl font-bold lang-card-title">
                        {item.name}
                      </h3>
                      <div class="flex items-center gap-2 mt-1">
                        <span class="text-sm lang-greeting font-medium" style={`color: ${config.color}`}>
                          "{flag.greeting}"
                        </span>
                        <span class="text-xs lang-phonetic opacity-50">
                          {flag.phonetic}
                        </span>
                      </div>
                    </div>

                    <!-- Level Badge -->
                    <div class="inline-flex items-center gap-2 mb-4">
                      <div
                        class="flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-semibold lang-level-pill"
                        style={`background: ${config.color}20; color: ${config.color}; border: 1px solid ${config.color}40`}
                      >
                        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"/>
                        </svg>
                        <span>{t(lang, `languages.levels.${item.level}`) || config.label}</span>
                        <span class="opacity-60">‚Ä¢ {config.percent}%</span>
                      </div>
                    </div>

                    <!-- Used For -->
                    <div>
                      <p class="text-xs font-medium lang-card-label uppercase tracking-wider mb-1.5 flex items-center gap-1.5">
                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                        </svg>
                        {t(lang, 'languages.usedFor') || 'Context'}
                      </p>
                      <p class="text-sm lang-card-text leading-relaxed">
                        {getStr(item.usedFor)}
                      </p>
                    </div>

                    <!-- Frequency Meter -->
                    <div class="mt-5 relative">
                      <div class="lang-frequency-track h-1.5 rounded-full overflow-hidden">
                        <div
                          class="lang-frequency-bar h-full rounded-full relative"
                          style={`--bar-width: ${config.percent}%; background: linear-gradient(90deg, ${config.color}, ${config.colorLight})`}
                          data-width={config.percent}
                        >
                          <!-- Traveling pulse -->
                          <div class="lang-frequency-pulse absolute inset-y-0 w-8"></div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Corner Sound Wave Decoration -->
              <div class="absolute bottom-0 right-0 w-32 h-32 pointer-events-none overflow-hidden opacity-10">
                <svg viewBox="0 0 100 100" class="w-full h-full">
                  {Array.from({ length: 5 }).map((_, i) => (
                    <circle
                      cx="100"
                      cy="100"
                      r={20 + i * 15}
                      fill="none"
                      stroke={config.color}
                      stroke-width="0.5"
                      class="lang-corner-wave"
                      style={`animation-delay: ${i * 0.2}s`}
                    />
                  ))}
                </svg>
              </div>
            </div>
          </div>
        );
      })}
      </div>
    </div>

    <!-- Stats with Equalizer Style -->
    <div class="mt-16 lang-reveal">
      <div class="relative max-w-3xl mx-auto">
        <div class="lang-stats-container rounded-2xl p-8 backdrop-blur-xl">
          <!-- Background frequency pattern -->
          <div class="absolute inset-0 lang-stats-freq-bg rounded-2xl overflow-hidden">
            <div class="lang-stats-wave"></div>
          </div>

          <div class="relative grid grid-cols-3 gap-8 text-center">
            <div class="lang-stat-item">
              <div class="lang-stat-icon mx-auto mb-2 w-10 h-10 rounded-full flex items-center justify-center">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129"/>
                </svg>
              </div>
              <div class="text-3xl md:text-4xl font-black lang-stat-value">
                <span class="sr-only">4</span>
                <span class="lang-counter" aria-hidden="true" data-target="4">0</span>
              </div>
              <div class="text-sm lang-stat-label mt-1">
                {lang === 'es' ? 'Idiomas' : lang === 'fr' ? 'Langues' : lang === 'pt' ? 'Idiomas' : 'Languages'}
              </div>
            </div>

            <div class="lang-stat-divider"></div>

            <div class="lang-stat-item">
              <div class="lang-stat-icon mx-auto mb-2 w-10 h-10 rounded-full flex items-center justify-center">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
              </div>
              <div class="text-3xl md:text-4xl font-black lang-stat-value">
                <span class="sr-only">3</span>
                <span class="lang-counter" aria-hidden="true" data-target="3">0</span>
              </div>
              <div class="text-sm lang-stat-label mt-1">
                {lang === 'es' ? 'Continentes' : lang === 'fr' ? 'Continents' : lang === 'pt' ? 'Continentes' : 'Continents'}
              </div>
            </div>

            <div class="lang-stat-divider"></div>

            <div class="lang-stat-item">
              <div class="lang-stat-icon mx-auto mb-2 w-10 h-10 rounded-full flex items-center justify-center">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
              </div>
              <div class="text-3xl md:text-4xl font-black lang-stat-value">
                <span class="sr-only">8</span>
                <span class="lang-counter" aria-hidden="true" data-target="8">0</span>+
              </div>
              <div class="text-sm lang-stat-label mt-1">
                {lang === 'es' ? 'A√±os' : lang === 'fr' ? 'Ann√©es' : lang === 'pt' ? 'Anos' : 'Years'}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  /* === SECTION BASE === */
  .lang-section {
    background: linear-gradient(180deg,
      var(--color-bg) 0%,
      var(--color-bg-alt) 50%,
      var(--color-bg) 100%
    );
  }

  /* === ECHO RIPPLES === */
  .lang-ripple-container {
    opacity: 0.15;
  }

  :global(.dark) .lang-ripple-container {
    opacity: 0.25;
  }

  :global(:root:not(.dark)) .lang-ripple-container {
    opacity: 0.35;
  }

  .lang-ripple {
    position: absolute;
    border-radius: 50%;
    border: 1px solid var(--color-accent);
    opacity: 0;
    animation: lang-ripple-expand 4s ease-out infinite;
  }

  :global(:root:not(.dark)) .lang-ripple {
    border-width: 2px;
    border-color: rgba(37, 99, 235, 0.55);
    box-shadow: 0 0 70px rgba(37, 99, 235, 0.2);
  }

  .lang-ripple-1 { animation-delay: 0s; }
  .lang-ripple-2 { animation-delay: 1.3s; }
  .lang-ripple-3 { animation-delay: 2.6s; }

  @keyframes lang-ripple-expand {
    0% {
      width: 100px;
      height: 100px;
      opacity: 0.6;
    }
    100% {
      width: 800px;
      height: 800px;
      opacity: 0;
    }
  }

  /* === FREQUENCY GRID === */
  .lang-freq-grid {
    background-image:
      linear-gradient(rgba(110, 231, 183, 0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(110, 231, 183, 0.03) 1px, transparent 1px);
    background-size: 40px 40px;
    mask-image: radial-gradient(ellipse at center, black 30%, transparent 70%);
  }

  /* === SOUND PARTICLES === */
  .lang-sound-particle {
    width: var(--particle-size);
    height: var(--particle-size);
    background: var(--color-accent);
    border-radius: 50%;
    opacity: 0;
    animation: lang-particle-pulse 3s ease-in-out infinite;
  }

  @keyframes lang-particle-pulse {
    0%, 100% {
      opacity: 0;
      transform: scale(0.5) translateY(0);
    }
    50% {
      opacity: 0.6;
      transform: scale(1) translateY(-20px);
    }
  }

  /* === VISUALIZER === */
  .lang-visualizer-bg {
    background: rgba(255, 255, 255, 0.8);
    border: 1px solid rgba(0, 0, 0, 0.05);
  }

  :global(.dark) .lang-visualizer-bg {
    background: rgba(15, 23, 42, 0.8);
    border-color: rgba(255, 255, 255, 0.1);
  }

  .lang-freq-bar {
    width: 4px;
    background: linear-gradient(180deg, #6ee7b7, #93c5fd, #c4b5fd);
    border-radius: 2px;
    animation: lang-freq-dance 1.2s ease-in-out infinite;
    animation-delay: var(--bar-delay);
    transform-origin: bottom;
  }

  @keyframes lang-freq-dance {
    0%, 100% { transform: scaleY(0.4); }
    50% { transform: scaleY(1); }
  }

  .lang-pulse-ring {
    border: 2px solid transparent;
    background: linear-gradient(135deg, #6ee7b7, #93c5fd, #c4b5fd) border-box;
    -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
    mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
    animation: lang-pulse-rotate 4s linear infinite;
    opacity: 0.5;
  }

  @keyframes lang-pulse-rotate {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  /* === HEADER TEXT === */
  .lang-badge-text {
    color: var(--color-accent);
  }

  :global(.dark) .lang-badge-text {
    color: rgba(255, 255, 255, 0.6);
  }

  .lang-title {
    color: var(--color-text);
  }

  :global(.dark) .lang-title {
    color: #ffffff;
  }

  .lang-subtitle {
    color: var(--color-text-muted);
  }

  :global(.dark) .lang-subtitle {
    color: rgba(255, 255, 255, 0.6);
  }

  /* === CARD STYLES === */
  .lang-card {
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.4s ease;
  }

  .lang-card:hover {
    transform: translateY(-4px);
  }

  .lang-card-bg {
    background: rgba(255, 255, 255, 0.9);
    border: 1px solid rgba(0, 0, 0, 0.06);
    backdrop-filter: blur(20px);
  }

  :global(.dark) .lang-card-bg {
    background: rgba(15, 23, 42, 0.7);
    border-color: rgba(255, 255, 255, 0.08);
  }

  .lang-card-wrapper:hover .lang-card {
    box-shadow:
      0 20px 40px -15px rgba(0, 0, 0, 0.1),
      0 0 0 1px var(--accent),
      0 0 30px -10px var(--accent);
  }

  :global(.dark) .lang-card-wrapper:hover .lang-card {
    box-shadow:
      0 20px 40px -15px rgba(0, 0, 0, 0.4),
      0 0 0 1px var(--accent),
      0 0 40px -10px var(--accent);
  }

  /* === WAVEFORM BACKGROUND === */
  .lang-waveform-path {
    animation: lang-waveform-flow var(--wave-speed) linear infinite;
    stroke-dasharray: 5, 3;
  }

  @keyframes lang-waveform-flow {
    0% { stroke-dashoffset: 0; }
    100% { stroke-dashoffset: -50; }
  }

  /* === MAGNETIC GLOW === */
  .lang-magnetic-glow {
    background: radial-gradient(
      circle at var(--mouse-x, 50%) var(--mouse-y, 50%),
      var(--accent) 0%,
      transparent 50%
    );
    opacity: 0.1;
  }

  /* === SOUND RINGS === */
  .lang-sound-ring {
    position: absolute;
    border-radius: 50%;
    border: 1px solid;
    opacity: 0;
    pointer-events: none;
  }

  .lang-card:hover .lang-sound-ring {
    animation: lang-sound-emit 1.5s ease-out infinite;
  }

  .lang-sound-ring-1 { animation-delay: 0s; }
  .lang-sound-ring-2 { animation-delay: 0.5s; }

  @keyframes lang-sound-emit {
    0% {
      width: 60px;
      height: 60px;
      opacity: 0.5;
    }
    100% {
      width: 120px;
      height: 120px;
      opacity: 0;
    }
  }

  /* === FLAG CONTAINER === */
  .lang-flag-container {
    background: rgba(255, 255, 255, 0.5);
    border: 1px solid rgba(0, 0, 0, 0.05);
  }

  :global(.dark) .lang-flag-container {
    background: rgba(255, 255, 255, 0.05);
    border-color: rgba(255, 255, 255, 0.1);
  }

  /* === LEVEL BADGE === */
  .lang-level-badge {
    background: rgba(255, 255, 255, 0.9);
    border: 1px solid rgba(0, 0, 0, 0.05);
    backdrop-filter: blur(10px);
  }

  :global(.dark) .lang-level-badge {
    background: rgba(15, 23, 42, 0.9);
    border-color: rgba(255, 255, 255, 0.1);
  }

  /* === CARD TEXT === */
  .lang-card-title {
    color: var(--color-text);
  }

  :global(.dark) .lang-card-title {
    color: #ffffff;
  }

  .lang-card-label {
    color: var(--color-text-muted);
  }

  :global(.dark) .lang-card-label {
    color: rgba(255, 255, 255, 0.5);
  }

  .lang-card-text {
    color: var(--color-text);
    opacity: 0.8;
  }

  :global(.dark) .lang-card-text {
    color: rgba(255, 255, 255, 0.8);
  }

  .lang-phonetic {
    color: var(--color-text-muted);
    font-family: monospace;
  }

  /* === FREQUENCY METER === */
  .lang-frequency-track {
    background: rgba(0, 0, 0, 0.08);
  }

  :global(.dark) .lang-frequency-track {
    background: rgba(255, 255, 255, 0.08);
  }

  .lang-frequency-bar {
    width: 0;
    transition: width 1.2s cubic-bezier(0.4, 0, 0.2, 1);
    overflow: hidden;
  }

  .lang-frequency-bar.is-visible {
    width: var(--bar-width);
  }

  .lang-frequency-pulse {
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.6), transparent);
    animation: lang-freq-travel 1.5s ease-in-out infinite;
  }

  @keyframes lang-freq-travel {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(400%); }
  }

  /* === CORNER WAVE === */
  .lang-corner-wave {
    animation: lang-corner-pulse 2s ease-out infinite;
  }

  @keyframes lang-corner-pulse {
    0% { opacity: 0.3; transform: scale(1); }
    100% { opacity: 0; transform: scale(1.2); }
  }

  /* === STATS === */
  .lang-stats-container {
    background: rgba(255, 255, 255, 0.8);
    border: 1px solid rgba(0, 0, 0, 0.05);
  }

  :global(.dark) .lang-stats-container {
    background: rgba(15, 23, 42, 0.6);
    border-color: rgba(255, 255, 255, 0.1);
  }

  .lang-stats-freq-bg {
    opacity: 0.05;
    overflow: hidden;
  }

  .lang-stats-wave {
    position: absolute;
    inset: 0;
    background: repeating-linear-gradient(
      90deg,
      var(--color-accent) 0px,
      var(--color-accent) 2px,
      transparent 2px,
      transparent 8px
    );
    animation: lang-stats-wave-move 2s linear infinite;
  }

  @keyframes lang-stats-wave-move {
    0% { transform: translateX(0); }
    100% { transform: translateX(8px); }
  }

  .lang-stat-icon {
    background: linear-gradient(135deg, #6ee7b7, #93c5fd);
    color: white;
  }

  .lang-stat-value {
    background: linear-gradient(135deg, #6ee7b7, #93c5fd, #c4b5fd);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .lang-stat-label {
    color: var(--color-text-muted);
  }

  :global(.dark) .lang-stat-label {
    color: rgba(255, 255, 255, 0.6);
  }

  .lang-stat-divider {
    display: none;
  }

  @media (min-width: 640px) {
    .lang-stats-container > div:last-child {
      grid-template-columns: 1fr auto 1fr auto 1fr;
    }

    .lang-stat-divider {
      display: block;
      width: 1px;
      height: 3rem;
      background: linear-gradient(180deg, transparent, var(--color-border), transparent);
      align-self: center;
    }
  }

  /* === REVEAL ANIMATIONS === */
  .lang-reveal {
    opacity: 0;
    transform: translateY(30px);
    transition: opacity 0.8s ease, transform 0.8s ease;
  }

  .lang-reveal.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  .lang-card-wrapper {
    transition-delay: calc(var(--card-index) * 150ms);
  }

  /* === CONNECTIONS (drawn by JS) === */
  :global(.lang-connection-line) {
    stroke: #93c5fd;
    stroke: url(#connection-gradient);
    stroke-width: 2;
    fill: none;
    filter: url(#glow-filter);
    opacity: 0;
    stroke-dasharray: 8, 4;
    animation: lang-connection-flow 2s linear infinite;
  }

  :global(.lang-connection-line.is-visible) {
    opacity: 0.4;
  }

  @keyframes lang-connection-flow {
    0% { stroke-dashoffset: 0; }
    100% { stroke-dashoffset: -24; }
  }

  /* === REDUCED MOTION === */
  @media (prefers-reduced-motion: reduce) {
    .lang-ripple,
    .lang-sound-particle,
    .lang-freq-bar,
    .lang-pulse-ring,
    .lang-waveform-path,
    .lang-sound-ring,
    .lang-frequency-pulse,
    .lang-corner-wave,
    .lang-stats-wave,
    .lang-connection-line {
      animation: none !important;
    }

    .lang-card,
    .lang-frequency-bar,
    .lang-reveal {
      transition: none !important;
    }

    .lang-reveal {
      opacity: 1 !important;
      transform: none !important;
    }
  }

  /* === RESPONSIVE === */
  @media (max-width: 768px) {
    .lang-card:hover {
      transform: none;
    }

    .lang-ripple-container {
      display: none;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const section = document.getElementById('languages');
    if (!section) return;

    // Intersection Observer for reveals and animations
    const observerOptions = {
      root: null,
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px'
    };

    const revealObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('is-visible');

          // Trigger frequency bars
          const bars = entry.target.querySelectorAll('.lang-frequency-bar');
          bars.forEach(bar => bar.classList.add('is-visible'));

          // Counter animation
          const counters = entry.target.querySelectorAll('.lang-counter');
          counters.forEach(counter => {
            const target = parseInt(counter.getAttribute('data-target') || '0');
            animateCounter(counter, target);
          });
        }
      });
    }, observerOptions);

    // Observe all reveal elements
    section.querySelectorAll('.lang-reveal').forEach(el => {
      revealObserver.observe(el);
    });

    // Counter animation function
    function animateCounter(element: Element, target: number) {
      let current = 0;
      const duration = 1500;
      const steps = 30;
      const increment = target / steps;
      const stepDuration = duration / steps;

      const timer = setInterval(() => {
        current += increment;
        if (current >= target) {
          current = target;
          clearInterval(timer);
        }
        element.textContent = Math.floor(current).toString();
      }, stepDuration);
    }

    // Magnetic glow effect on cards
    const cards = section.querySelectorAll('.lang-card');
    cards.forEach(card => {
      card.addEventListener('mousemove', (e) => {
        const rect = card.getBoundingClientRect();
        const x = ((e.clientX - rect.left) / rect.width) * 100;
        const y = ((e.clientY - rect.top) / rect.height) * 100;
        (card as HTMLElement).style.setProperty('--mouse-x', `${x}%`);
        (card as HTMLElement).style.setProperty('--mouse-y', `${y}%`);
      });
    });

    // Generate waveform paths for each card
    const waveforms = section.querySelectorAll('.lang-waveform-path');
    waveforms.forEach((path, index) => {
      const d = generateWaveformPath(400, 200, index);
      path.setAttribute('d', d);
    });

    function generateWaveformPath(width: number, height: number, seed: number): string {
      const centerY = height / 2;
      const amplitude = height * 0.3;
      const frequency = 0.03 + (seed * 0.005);

      let d = `M 0 ${centerY}`;
      for (let x = 0; x <= width; x += 4) {
        const y = centerY + Math.sin(x * frequency + seed) * amplitude * Math.sin(x * 0.01);
        d += ` L ${x} ${y}`;
      }
      return d;
    }

    // Draw connection lines between related languages
    drawConnections();

    function drawConnections() {
      const svg = section.querySelector('.lang-connections-svg');
      const grid = document.getElementById('lang-cards-grid');
      if (!svg || !grid) return;

      // Language connections data
      const connections = [
        { from: 'spanish', to: 'portuguese' },
        { from: 'spanish', to: 'french' },
      ];

      connections.forEach(conn => {
        const fromCard = grid.querySelector(`[data-language="${conn.from}"]`);
        const toCard = grid.querySelector(`[data-language="${conn.to}"]`);

        if (fromCard && toCard) {
          const fromRect = fromCard.getBoundingClientRect();
          const toRect = toCard.getBoundingClientRect();
          const gridRect = grid.getBoundingClientRect();

          const x1 = fromRect.left + fromRect.width / 2 - gridRect.left;
          const y1 = fromRect.top + fromRect.height / 2 - gridRect.top;
          const x2 = toRect.left + toRect.width / 2 - gridRect.left;
          const y2 = toRect.top + toRect.height / 2 - gridRect.top;

          const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');

          // Create curved path
          const midX = (x1 + x2) / 2;
          const midY = (y1 + y2) / 2 - 50;
          const d = `M ${x1} ${y1} Q ${midX} ${midY} ${x2} ${y2}`;

          path.setAttribute('d', d);
          path.setAttribute('class', 'lang-connection-line');
          path.setAttribute('fill', 'none');
          svg.appendChild(path);

          // Animate visibility
          setTimeout(() => {
            path.classList.add('is-visible');
          }, 1000);
        }
      });
    }

    // Redraw connections on resize
    let resizeTimeout: ReturnType<typeof setTimeout>;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(() => {
        const svg = section.querySelector('.lang-connections-svg');
        if (svg) {
          svg.innerHTML = `
            <defs>
              <linearGradient id="connection-gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" style="stop-color:#6ee7b7;stop-opacity:0.6"/>
                <stop offset="50%" style="stop-color:#93c5fd;stop-opacity:0.8"/>
                <stop offset="100%" style="stop-color:#c4b5fd;stop-opacity:0.6"/>
              </linearGradient>
              <filter id="glow-filter">
                <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
                <feMerge>
                  <feMergeNode in="coloredBlur"/>
                  <feMergeNode in="SourceGraphic"/>
                </feMerge>
              </filter>
            </defs>
          `;
          drawConnections();
        }
      }, 250);
    });
  });
</script>
