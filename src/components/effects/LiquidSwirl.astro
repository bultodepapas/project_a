---
/**
 * LiquidSwirl Component - SIMPLIFIED VERSION
 * 
 * Efecto de spotlight líquido que sigue el cursor
 * Basado en el patrón exitoso de ChapterDeck y Education
 * 
 * Props:
 * - intensity: número 0-1, qué tan intenso es el efecto
 * - radius: radio del vórtice en px
 * - color: color base del efecto
 */

interface Props {
  intensity?: number;
  radius?: number;
  color?: string;
}

const { intensity = 0.8, radius = 600, color = 'rgba(255,255,255,0.25)' } = Astro.props;
---

<div class="liquid-swirl-wrapper" data-liquid-card>
  {/* Spotlight effect (follows cursor) */}
  <div 
    class="liquid-spotlight" 
    data-spotlight
    style={`
      --intensity: ${intensity};
      --radius: ${radius}px;
      --spot-color: ${color};
    `}
  ></div>

  {/* Slot para contenido (la tarjeta real) */}
  <slot />
</div>

<style>
  .liquid-swirl-wrapper {
    position: relative;
    display: block;
    width: 100%;
    height: 100%;
  }

  .liquid-spotlight {
    position: absolute;
    inset: 0;
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
    border-radius: inherit;
    z-index: 10;
    
    /* Gradiente radial que sigue el cursor - MAS INTENSO */
    background: radial-gradient(
      var(--radius, 600px) circle at var(--mouse-x, 50%) var(--mouse-y, 50%),
      var(--spot-color, rgba(255,255,255,0.35)) 0%,
      rgba(255,255,255,0.22) 15%,
      rgba(255,255,255,0.12) 30%,
      rgba(255,255,255,0.05) 50%,
      transparent 70%
    );
    
    /* Efectos adicionales para "liquid feel" */
    filter: blur(0.5px);
    mix-blend-mode: screen;
  }

  /* Show on hover */
  .liquid-swirl-wrapper:hover .liquid-spotlight {
    opacity: 1;
  }

  /* Dark mode enhancement */
  :global(:root.dark) .liquid-spotlight {
    background: radial-gradient(
      var(--radius, 600px) circle at var(--mouse-x, 50%) var(--mouse-y, 50%),
      var(--spot-color, rgba(255,255,255,0.4)) 0%,
      rgba(255,255,255,0.28) 15%,
      rgba(255,255,255,0.16) 30%,
      rgba(255,255,255,0.08) 50%,
      transparent 70%
    );
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .liquid-spotlight {
      display: none;
    }
  }
</style>

<script>
  // Initialize spotlight effect on mount
  function initLiquidSpotlight() {
    const cards = document.querySelectorAll('[data-liquid-card]');
    
    cards.forEach(card => {
      const spotlight = card.querySelector('[data-spotlight]') as HTMLElement;
      if (!spotlight) return;

      card.addEventListener('mousemove', (e) => {
        const rect = card.getBoundingClientRect();
        const x = ((e.clientX - rect.left) / rect.width) * 100;
        const y = ((e.clientY - rect.top) / rect.height) * 100;
        spotlight.style.setProperty('--mouse-x', `${x}%`);
        spotlight.style.setProperty('--mouse-y', `${y}%`);
      });

      card.addEventListener('mouseenter', () => {
        spotlight.style.opacity = '0.95';
      });

      card.addEventListener('mouseleave', () => {
        spotlight.style.opacity = '0';
      });
    });
  }

  // Run on load
  if (typeof document !== 'undefined') {
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initLiquidSpotlight);
    } else {
      initLiquidSpotlight();
    }

    // Reinitialize after view transitions
    document.addEventListener('astro:page-load', initLiquidSpotlight);
  }
</script>
