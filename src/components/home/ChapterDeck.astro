---
import { t } from '@/i18n';
import type { Lang } from '@/i18n/config';

interface SystemCard {
  slug: string;
  eyebrow: string;
  icon: string;
  color: string;
  accentGradient: string;
  stats: {
    value: string;
    label: Record<string, string>;
  };
  title: Record<string, string>;
  description: Record<string, string>;
  features: Array<Record<string, string>>;
}

interface Props {
  lang: Lang;
  chapters: SystemCard[];
}

const { lang, chapters } = Astro.props;

// Helper to get localized string
const getStr = (obj: any) => (typeof obj === 'string' ? obj : obj[lang] || obj.en);

// Icon SVG paths (enhanced with more icons)
const iconPaths: Record<string, string> = {
  users: 'M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2M9 11a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75',
  chart: 'M18 20V10M12 20V4M6 20v-6',
  pulse: 'M22 12h-4l-3 9L9 3l-3 9H2'
};
---

<section id="systems" class="relative z-10 overflow-hidden transition-colors duration-700" data-systems-section>
  <!-- Premium Animated Background -->
  <div class="absolute inset-0 pointer-events-none overflow-hidden">
    <!-- Deep gradient base -->
    <div class="absolute inset-0 bg-gradient-to-b from-background via-background-alt/30 to-background"></div>

    <!-- Animated mesh gradient orbs -->
    <div class="system-orb orb-primary absolute w-[800px] h-[800px] rounded-full blur-[120px] opacity-0 transition-all duration-1000"
         style="top: -20%; left: -15%; background: radial-gradient(circle, var(--orb-color, #6ee7b7) 0%, transparent 70%);"></div>
    <div class="system-orb orb-secondary absolute w-[600px] h-[600px] rounded-full blur-[100px] opacity-0 transition-all duration-1000"
         style="bottom: -10%; right: -10%; background: radial-gradient(circle, var(--orb-color-secondary, #93c5fd) 0%, transparent 70%);"></div>

    <!-- Constellation grid pattern -->
    <svg class="absolute inset-0 w-full h-full opacity-[0.015]" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <pattern id="systems-constellation" width="100" height="100" patternUnits="userSpaceOnUse">
          <circle cx="50" cy="50" r="1" fill="currentColor" class="text-foreground"/>
          <circle cx="0" cy="0" r="0.5" fill="currentColor" class="text-foreground"/>
          <circle cx="100" cy="0" r="0.5" fill="currentColor" class="text-foreground"/>
          <circle cx="0" cy="100" r="0.5" fill="currentColor" class="text-foreground"/>
          <circle cx="100" cy="100" r="0.5" fill="currentColor" class="text-foreground"/>
        </pattern>
      </defs>
      <rect width="100%" height="100%" fill="url(#systems-constellation)" />
    </svg>

    <!-- Floating light particles (Canvas rendered) -->
    <canvas id="systems-particles" class="absolute inset-0 w-full h-full opacity-60"></canvas>
  </div>

  <!-- Left fade gradient for depth -->
  <div class="absolute left-0 top-0 h-full w-[35%] bg-gradient-to-r from-background via-background/60 to-transparent pointer-events-none hidden md:block z-10"></div>

  <!-- Pinned Container -->
  <div class="chapter-pin-wrapper relative min-h-screen flex items-center py-12 md:py-16">
    <div class="container relative flex flex-col justify-center">
      <div class="grid md:grid-cols-[minmax(280px,380px)_1fr] md:gap-12 lg:gap-16 items-start">

        <!-- Static Header - Premium Design -->
        <div class="mb-8 md:mb-0 max-w-md relative z-20">
          <!-- Floating eyebrow badge -->
          <div class="inline-flex items-center gap-2.5 px-5 py-2.5 rounded-full bg-gradient-to-r from-accent/15 to-accent/5 border border-accent/25 mb-5 reveal-header opacity-0 translate-y-4 backdrop-blur-sm">
            <div class="relative">
              <svg class="w-4 h-4 text-accent" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
              </svg>
              <div class="absolute inset-0 animate-ping opacity-30">
                <svg class="w-4 h-4 text-accent" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                </svg>
              </div>
            </div>
            <span class="text-sm font-semibold text-accent tracking-wide">
              {lang === 'es' ? 'Sistemas de Impacto' : lang === 'fr' ? 'Syst√®mes d\'Impact' : lang === 'pt' ? 'Sistemas de Impacto' : 'Impact Systems'}
            </span>
          </div>

          <!-- Main title with gradient text -->
          <h2 class="text-4xl md:text-5xl lg:text-6xl font-bold mb-3 reveal-header opacity-0 translate-y-4 leading-[1.1]" style="transition-delay: 100ms;">
            <span class="bg-gradient-to-br from-foreground via-foreground to-muted bg-clip-text text-transparent">
              {t(lang, 'systems.title')}
            </span>
          </h2>

          <p class="text-base md:text-lg text-muted mb-6 reveal-header opacity-0 translate-y-4 leading-relaxed" style="transition-delay: 200ms;">
            {t(lang, 'systems.subtitle')}
          </p>

          <!-- Premium Progress Indicator -->
          <div class="hidden md:block reveal-header opacity-0 translate-y-4" style="transition-delay: 300ms;">
            <!-- Navigation dots with labels -->
            <div class="flex items-center gap-4 mb-3">
              {chapters.map((chapter, i) => (
                <button
                  class="chapter-nav-dot group relative flex flex-col items-center gap-2 transition-all duration-500"
                  data-index={i}
                  data-color={chapter.color}
                >
                  <!-- Progress ring -->
                  <div class="relative w-10 h-10">
                    <svg class="w-10 h-10 -rotate-90" viewBox="0 0 40 40">
                      <circle
                        cx="20" cy="20" r="16"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        class="text-border/30"
                      />
                      <circle
                        cx="20" cy="20" r="16"
                        fill="none"
                        stroke={chapter.color}
                        stroke-width="2.5"
                        stroke-linecap="round"
                        class="progress-ring opacity-0 transition-all duration-700"
                        style="stroke-dasharray: 100.5; stroke-dashoffset: 100.5;"
                      />
                    </svg>
                    <!-- Center number -->
                    <span class="absolute inset-0 flex items-center justify-center text-xs font-bold text-muted transition-colors duration-300"
                          style={`--active-color: ${chapter.color};`}>
                      0{i + 1}
                    </span>
                  </div>

                  <!-- Label -->
                  <span class="text-[10px] font-medium text-muted/60 opacity-0 transition-all duration-300 group-hover:opacity-100 uppercase tracking-wider">
                    {chapter.eyebrow}
                  </span>
                </button>
              ))}
            </div>

            <!-- Linear progress bar -->
            <div class="relative h-0.5 w-full bg-border/20 rounded-full overflow-hidden">
              <div class="scroll-progress absolute inset-y-0 left-0 rounded-full transition-all duration-150 ease-out"
                   style="width: 0%; background: linear-gradient(90deg, #6ee7b7, #93c5fd, #c4b5fd);"></div>
              <!-- Glow effect -->
              <div class="scroll-progress-glow absolute inset-y-0 left-0 rounded-full blur-sm opacity-50 transition-all duration-150 ease-out"
                   style="width: 0%; background: linear-gradient(90deg, #6ee7b7, #93c5fd, #c4b5fd);"></div>
            </div>
          </div>
        </div>

        <!-- Premium Cards Stack -->
        <div class="chapters-stack relative w-full max-w-4xl h-[500px] md:h-[540px] lg:h-[560px]" style="perspective: 1500px;">
          {chapters.map((chapter, index) => {
            const iconPath = iconPaths[chapter.icon] || iconPaths.users;

            return (
              <article
                class="chapter-card absolute inset-0 w-full h-full rounded-[2rem] opacity-0 translate-y-8"
                data-index={index}
                data-color={chapter.color}
                style={`--card-color: ${chapter.color}; --card-index: ${index};`}
              >
                <!-- Outer glow layer -->
                <div class="card-glow absolute -inset-4 rounded-[2.5rem] opacity-0 blur-3xl transition-opacity duration-1000"
                     style={`background: ${chapter.color}25;`}></div>

                <!-- Holographic border effect -->
                <div class="card-holographic absolute -inset-[1px] rounded-[2rem] opacity-0 transition-opacity duration-500"
                     style={`background: linear-gradient(135deg, ${chapter.color}40, transparent 40%, transparent 60%, ${chapter.color}40);`}></div>

                <!-- Main card body -->
                <div class="card-body relative h-full rounded-[2rem] overflow-hidden border border-white/10 shadow-2xl">
                  <!-- Glassmorphism background -->
                  <div class="absolute inset-0 bg-surface/85 backdrop-blur-2xl"></div>

                  <!-- Top accent bar with gradient -->
                  <div class="absolute top-0 inset-x-0 h-1.5"
                       style={`background: linear-gradient(90deg, transparent, ${chapter.color}, ${chapter.color}80, transparent);`}></div>

                  <!-- Spotlight effect (follows cursor) -->
                  <div class="card-spotlight absolute inset-0 opacity-0 transition-opacity duration-300 pointer-events-none"
                       style="background: radial-gradient(600px circle at var(--mouse-x, 50%) var(--mouse-y, 50%), rgba(255,255,255,0.06), transparent 40%);"></div>

                  <!-- Subtle pattern overlay -->
                  <div class="absolute inset-0 opacity-[0.02]" style="background-image: radial-gradient(circle at 1px 1px, currentColor 1px, transparent 1px); background-size: 24px 24px;"></div>

                  <!-- Content container -->
                  <div class="relative h-full flex flex-col p-5 md:p-7 lg:p-8">

                    <!-- Header row -->
                    <div class="flex items-start justify-between mb-4 md:mb-5">
                      <!-- Eyebrow and chapter number -->
                      <div class="flex items-center gap-4">
                        <span class="px-3 py-1 rounded-full text-[10px] md:text-xs font-bold uppercase tracking-widest border"
                              style={`background: ${chapter.color}15; color: ${chapter.color}; border-color: ${chapter.color}30;`}>
                          {chapter.eyebrow}
                        </span>
                        <!-- Large watermark number -->
                        <span class="text-5xl md:text-6xl font-black text-foreground/[0.04] leading-none select-none"
                              style="font-feature-settings: 'tnum';">
                          0{index + 1}
                        </span>
                      </div>

                      <!-- Animated icon with orbital ring -->
                      <div class="icon-container relative flex-shrink-0">
                        <!-- Orbital ring -->
                        <svg class="absolute -inset-3 w-18 h-18 md:w-20 md:h-20" viewBox="0 0 80 80">
                          <defs>
                            <linearGradient id={`icon-gradient-${index}`} x1="0%" y1="0%" x2="100%" y2="100%">
                              <stop offset="0%" style={`stop-color: ${chapter.color}; stop-opacity: 0.6`}/>
                              <stop offset="100%" style={`stop-color: ${chapter.color}; stop-opacity: 0.1`}/>
                            </linearGradient>
                          </defs>
                          <circle
                            cx="40" cy="40" r="36"
                            fill="none"
                            stroke={`url(#icon-gradient-${index})`}
                            stroke-width="1"
                            stroke-dasharray="6 5"
                            class="animate-spin-slow origin-center"
                          />
                        </svg>

                        <!-- Icon background with glass effect -->
                        <div class="relative w-12 h-12 md:w-14 md:h-14 rounded-xl flex items-center justify-center overflow-hidden"
                             style={`background: linear-gradient(135deg, ${chapter.color}25, ${chapter.color}10);`}>
                          <!-- Inner glow -->
                          <div class="absolute inset-0 opacity-50"
                               style={`background: radial-gradient(circle at 30% 30%, ${chapter.color}30, transparent 60%);`}></div>

                          <svg class="relative w-6 h-6 md:w-7 md:h-7" viewBox="0 0 24 24" fill="none" stroke={chapter.color} stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d={iconPath}/>
                          </svg>
                        </div>
                      </div>
                    </div>

                    <!-- Title with shine effect -->
                    <h3 class="card-title relative text-2xl md:text-3xl lg:text-4xl font-bold text-foreground mb-2 leading-tight overflow-hidden">
                      <span class="relative z-10">{getStr(chapter.title)}</span>
                      <!-- Shine sweep -->
                      <span class="title-shine absolute inset-0 w-full h-full bg-gradient-to-r from-transparent via-white/20 to-transparent -translate-x-full"></span>
                    </h3>

                    <!-- Description -->
                    <p class="text-base md:text-lg text-muted mb-4 max-w-2xl leading-relaxed">
                      {getStr(chapter.description)}
                    </p>

                    <!-- Features with staggered reveal -->
                    <div class="flex flex-wrap gap-2.5 mb-4">
                      {chapter.features.map((feature, fIndex) => (
                        <div
                          class="feature-pill flex items-center gap-2 px-4 py-2 rounded-full transition-all duration-300 hover:scale-105 cursor-default"
                          style={`
                            background: linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03));
                            border: 1px solid rgba(255,255,255,0.1);
                            transition-delay: ${fIndex * 80}ms;
                          `}
                        >
                          <svg class="w-3.5 h-3.5 flex-shrink-0" viewBox="0 0 20 20" fill={chapter.color}>
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                          </svg>
                          <span class="text-xs md:text-sm font-medium text-foreground/80">{getStr(feature)}</span>
                        </div>
                      ))}
                    </div>

                    <!-- Bottom row: Stats and CTA -->
                    <div class="mt-auto flex items-end justify-between gap-4">
                      <!-- Animated stat box -->
                      <div class="stats-display relative p-4 rounded-xl overflow-hidden"
                           style="background: linear-gradient(135deg, rgba(0,0,0,0.12), rgba(0,0,0,0.04));">
                        <!-- Subtle border -->
                        <div class="absolute inset-0 rounded-xl border border-white/5"></div>

                        <div class="relative flex items-baseline gap-2">
                          <!-- Animated counter -->
                          <span class="stat-value text-4xl md:text-5xl font-black tabular-nums"
                                style={`color: ${chapter.color};`}
                                data-value={chapter.stats.value}>
                            {chapter.stats.value}
                          </span>
                          <span class="text-xs md:text-sm text-muted font-medium">
                            {getStr(chapter.stats.label)}
                          </span>
                        </div>
                      </div>

                      <!-- Premium CTA button -->
                      <a
                        href={`/${lang}/case-studies/${chapter.slug}`}
                        class="cta-button group relative inline-flex items-center gap-2.5 px-5 py-3 rounded-full text-sm font-semibold transition-all duration-300 hover:scale-105 hover:shadow-xl overflow-hidden"
                        style={`background: ${chapter.color}; color: #0f172a;`}
                      >
                        <!-- Shine sweep on hover -->
                        <span class="absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-700"></span>

                        <span class="relative">{t(lang, 'systems.viewCase')}</span>
                        <svg class="relative w-4 h-4 transition-transform duration-300 group-hover:translate-x-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                          <path d="M5 12h14M12 5l7 7-7 7"/>
                        </svg>
                      </a>
                    </div>
                  </div>
                </div>
              </article>
            );
          })}
        </div>
      </div>
    </div>
  </div>

  <!-- Mobile Fallback / Reduced Motion (Premium Accordion) -->
  <div class="chapter-accordion hidden flex-col gap-4 container pb-8">
    {chapters.map((chapter, index) => {
      const iconPath = iconPaths[chapter.icon] || iconPaths.users;

      return (
        <article
          class="mobile-card group relative rounded-2xl overflow-hidden transition-all duration-500 hover:scale-[1.02]"
          style={`--card-color: ${chapter.color};`}
        >
          <!-- Glassmorphism background -->
          <div class="absolute inset-0 bg-surface/90 backdrop-blur-xl"></div>

          <!-- Top accent -->
          <div class="absolute top-0 inset-x-0 h-1" style={`background: ${chapter.color};`}></div>

          <!-- Border -->
          <div class="absolute inset-0 rounded-2xl border border-white/10"></div>

          <div class="relative p-6">
            <!-- Header -->
            <div class="flex items-start justify-between mb-3">
              <div class="flex items-center gap-3">
                <div class="w-12 h-12 rounded-xl flex items-center justify-center"
                     style={`background: ${chapter.color}20;`}>
                  <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke={chapter.color} stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d={iconPath}/>
                  </svg>
                </div>
                <span class="px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider"
                      style={`background: ${chapter.color}15; color: ${chapter.color};`}>
                  {chapter.eyebrow}
                </span>
              </div>
              <span class="text-4xl font-black text-foreground/5">0{index + 1}</span>
            </div>

            <!-- Content -->
            <h3 class="text-xl font-bold text-foreground mb-1.5 group-hover:text-accent transition-colors">
              {getStr(chapter.title)}
            </h3>
            <p class="text-muted mb-4 text-sm leading-relaxed">
              {getStr(chapter.description)}
            </p>

            <!-- Footer -->
            <div class="flex items-center justify-between">
              <div class="flex items-baseline gap-2">
                <span class="text-3xl font-bold" style={`color: ${chapter.color};`}>{chapter.stats.value}</span>
                <span class="text-xs text-muted">{getStr(chapter.stats.label)}</span>
              </div>
              <a
                href={`/${lang}/case-studies/${chapter.slug}`}
                class="inline-flex items-center gap-2 text-sm font-semibold transition-all duration-300 hover:gap-3"
                style={`color: ${chapter.color};`}
              >
                {t(lang, 'systems.viewCase')}
                <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M5 12h14M12 5l7 7-7 7"/>
                </svg>
              </a>
            </div>
          </div>
        </article>
      );
    })}
  </div>
</section>

<script>
  import { initChapterDeck } from '@/lib/motion';
  import { initOnce } from '@/lib/lifecycle';
  import { createRevealObserver } from '@/lib/ui/animations';

  function initParticleSystem(canvas: HTMLCanvasElement) {
    const ctx = canvas.getContext('2d');
    if (!ctx) return () => {};

    let animationId: number;
    const particles: Array<{
      x: number;
      y: number;
      vx: number;
      vy: number;
      radius: number;
      opacity: number;
      color: string;
    }> = [];

    const colors = ['#6ee7b7', '#93c5fd', '#c4b5fd'];

    function resize() {
      canvas.width = canvas.offsetWidth * window.devicePixelRatio;
      canvas.height = canvas.offsetHeight * window.devicePixelRatio;
      ctx!.scale(window.devicePixelRatio, window.devicePixelRatio);
    }

    function createParticle() {
      return {
        x: Math.random() * canvas.offsetWidth,
        y: Math.random() * canvas.offsetHeight,
        vx: (Math.random() - 0.5) * 0.3,
        vy: (Math.random() - 0.5) * 0.3,
        radius: Math.random() * 2 + 0.5,
        opacity: Math.random() * 0.5 + 0.1,
        color: colors[Math.floor(Math.random() * colors.length)]
      };
    }

    function init() {
      resize();
      particles.length = 0;
      const count = Math.min(40, Math.floor((canvas.offsetWidth * canvas.offsetHeight) / 25000));
      for (let i = 0; i < count; i++) {
        particles.push(createParticle());
      }
    }

    function animate() {
      ctx!.clearRect(0, 0, canvas.offsetWidth, canvas.offsetHeight);

      particles.forEach(p => {
        p.x += p.vx;
        p.y += p.vy;

        if (p.x < 0 || p.x > canvas.offsetWidth) p.vx *= -1;
        if (p.y < 0 || p.y > canvas.offsetHeight) p.vy *= -1;

        ctx!.beginPath();
        ctx!.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
        ctx!.fillStyle = p.color;
        ctx!.globalAlpha = p.opacity;
        ctx!.fill();
      });

      ctx!.globalAlpha = 1;
      animationId = requestAnimationFrame(animate);
    }

    init();
    animate();
    window.addEventListener('resize', init);

    return () => {
      cancelAnimationFrame(animationId);
      window.removeEventListener('resize', init);
    };
  }

  function initSpotlightEffect(section: HTMLElement) {
    const cards = section.querySelectorAll('.chapter-card');

    cards.forEach(card => {
      const cardBody = card.querySelector('.card-body') as HTMLElement;
      if (!cardBody) return;

      cardBody.addEventListener('mousemove', (e) => {
        const rect = cardBody.getBoundingClientRect();
        const x = ((e.clientX - rect.left) / rect.width) * 100;
        const y = ((e.clientY - rect.top) / rect.height) * 100;
        cardBody.style.setProperty('--mouse-x', `${x}%`);
        cardBody.style.setProperty('--mouse-y', `${y}%`);
      });

      cardBody.addEventListener('mouseenter', () => {
        const spotlight = cardBody.querySelector('.card-spotlight') as HTMLElement;
        const holographic = card.querySelector('.card-holographic') as HTMLElement;
        if (spotlight) spotlight.style.opacity = '1';
        if (holographic) holographic.style.opacity = '1';
      });

      cardBody.addEventListener('mouseleave', () => {
        const spotlight = cardBody.querySelector('.card-spotlight') as HTMLElement;
        const holographic = card.querySelector('.card-holographic') as HTMLElement;
        if (spotlight) spotlight.style.opacity = '0';
        if (holographic) holographic.style.opacity = '0';
      });
    });
  }

  function initTitleShine(section: HTMLElement) {
    const cards = section.querySelectorAll('.chapter-card');

    cards.forEach(card => {
      const shine = card.querySelector('.title-shine') as HTMLElement;
      if (!shine) return;

      card.addEventListener('mouseenter', () => {
        shine.style.transition = 'transform 0.8s ease';
        shine.style.transform = 'translateX(200%)';
      });

      card.addEventListener('mouseleave', () => {
        shine.style.transition = 'none';
        shine.style.transform = 'translateX(-100%)';
      });
    });
  }

  function initSystems() {
    const section = document.getElementById('systems');
    initOnce(section, 'systems', (root) => {
      let bodyObserver: IntersectionObserver | null = null;
      let cleanupParticles = () => {};

      // Initialize chapter deck animation
      initChapterDeck(root as HTMLElement);

      // Initialize particle system
      const canvas = root.querySelector('#systems-particles') as HTMLCanvasElement;
      if (canvas && window.innerWidth >= 768 && !window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
        cleanupParticles = initParticleSystem(canvas);
      }

      // Initialize spotlight effect
      initSpotlightEffect(root);

      // Initialize title shine effect
      initTitleShine(root);

      // Reveal animations
      const cleanupReveal = createRevealObserver(root, {
        selector: '.reveal-header',
        threshold: 0.2,
        onReveal: (el) => {
          el.classList.remove('opacity-0', 'translate-y-4');
          el.classList.add('opacity-100', 'translate-y-0');
        },
      });

      // Body class observer
      bodyObserver = new IntersectionObserver(
        ([entry]) => {
          document.body.classList.toggle('section-systems', entry.isIntersecting);
        },
        { threshold: 0.2 }
      );
      bodyObserver.observe(root);

      return () => {
        cleanupReveal();
        cleanupParticles();
        bodyObserver?.disconnect();
        document.body.classList.remove('section-systems');
      };
    });
  }

  initSystems();
  document.addEventListener('astro:page-load', initSystems);
</script>

<style>
  /* Spin animation for orbital rings */
  .animate-spin-slow {
    animation: spin 30s linear infinite;
  }

  @keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }

  /* Card stack base styles */
  .chapter-card {
    transform-origin: center center;
    will-change: transform, opacity;
    transform-style: preserve-3d;
  }

  .chapters-stack .chapter-card {
    box-shadow:
      0 25px 50px -12px rgba(0, 0, 0, 0.25),
      0 0 0 1px rgba(255, 255, 255, 0.05);
  }

  /* Active card glow enhancement */
  .chapter-card[style*="opacity: 1"] .card-glow {
    opacity: 0.4 !important;
  }

  /* Progress ring animation for active dot */
  .chapter-nav-dot.active .progress-ring {
    opacity: 1 !important;
    stroke-dashoffset: 0 !important;
  }

  .chapter-nav-dot.active span {
    color: var(--active-color) !important;
    font-weight: 800;
  }

  .chapter-nav-dot.active .text-muted\/60 {
    opacity: 1 !important;
    color: var(--active-color) !important;
  }

  /* Header reveal transitions */
  .reveal-header {
    transition: opacity 0.8s cubic-bezier(0.16, 1, 0.3, 1),
                transform 0.8s cubic-bezier(0.16, 1, 0.3, 1);
  }

  /* Feature pills hover glow */
  .feature-pill:hover {
    box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.2);
  }

  /* CTA button pulse on active card */
  .chapter-card[style*="opacity: 1"] .cta-button {
    box-shadow: 0 0 30px color-mix(in srgb, var(--card-color) 40%, transparent);
  }

  /* Stats value glow */
  .stat-value {
    text-shadow: 0 0 40px currentColor;
  }

  /* Mobile card hover effects */
  .mobile-card:hover {
    box-shadow: 0 20px 40px -15px rgba(0, 0, 0, 0.2);
  }

  .mobile-card::before {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(
      circle at var(--mouse-x, 50%) var(--mouse-y, 50%),
      rgba(255, 255, 255, 0.05) 0%,
      transparent 50%
    );
    opacity: 0;
    transition: opacity 0.3s;
  }

  .mobile-card:hover::before {
    opacity: 1;
  }

  /* Progress bar glow sync */
  .scroll-progress,
  .scroll-progress-glow {
    transition: width 0.1s linear;
  }

  /* Dark mode enhancements */
  :root.dark .card-body {
    background: rgba(15, 23, 42, 0.9);
  }

  :root.dark .chapter-card {
    box-shadow:
      0 25px 50px -12px rgba(0, 0, 0, 0.5),
      0 0 0 1px rgba(255, 255, 255, 0.03);
  }

  :root.dark .mobile-card {
    background: rgba(15, 23, 42, 0.85);
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .chapter-card,
    .animate-spin-slow,
    .title-shine,
    .card-spotlight,
    .card-holographic {
      animation: none !important;
      transition: opacity 0.3s ease !important;
    }

    .reveal-header {
      opacity: 1 !important;
      transform: none !important;
    }

    #systems-particles {
      display: none;
    }
  }
</style>
